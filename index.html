<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantix Interactive GTM Dashboard | quantix.finance</title>
    <!-- For production, consider moving JS/CSS to external files -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1117; --card-bg: #161b22; --border-color: #30363d;
            --text-primary: #e6edf3; --text-secondary: #848d97;
            --accent-blue: #58a6ff; --accent-green: #3fb950; --accent-red: #f85149; --accent-orange: #f77829; --accent-purple: #8a63d2;
            --summary-header-bg: #2d333b;
            --summary-total-bg: #22272e;
        }
        * { scroll-behavior: smooth; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary); margin: 0; padding: 1rem; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1, h2, h3, h4 { font-weight: 700; letter-spacing: -0.02em; }
        h1 { font-size: 2rem; text-align: center; margin-bottom: 0.5rem; }
        h2 { font-size: 1.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;}
        h3 { font-size: 1.25rem; }
        h4 { font-size: 1.1rem; color: var(--accent-blue); margin-top: 1.5rem; margin-bottom: 0.5rem; }
        p { line-height: 1.6; }
        p.subtitle { text-align: center; color: var(--text-secondary); font-size: 1rem; margin-top:0; margin-bottom: 2rem;}
        section { margin-bottom: 3rem; }
        .card { background: var(--card-bg); padding: 1rem; border-radius: 12px; border: 1px solid var(--border-color); }
        .dashboard-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1rem; }
        .controls-container { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2.5rem; flex-wrap: wrap;}
        .control-group { display: flex; background-color: var(--card-bg); border-radius: 12px; padding: 0.5rem; border: 1px solid var(--border-color); align-items: center; flex-wrap: wrap; justify-content: center;}
        .control-btn { background: transparent; border: none; color: var(--text-secondary); padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .control-btn.active { background-color: var(--accent-blue); color: #fff; box-shadow: 0 4px 15px rgba(88, 166, 255, 0.2); }
        .slider-control { padding: 0.5rem 1rem; text-align: center; width: 100%;}
        .slider-control label { font-weight: 600; font-size: 0.9rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;}
        .slider-control input[type="range"] { width: 100%; max-width: 200px; }
        .slider-control span { font-size: 1.1rem; font-weight: 700; color: var(--accent-blue); display: inline-block; min-width: 70px; text-align: left; }
        .kpi-card { grid-column: span 12; }
        .kpi-card h3 { font-size: 1rem; font-weight: 500; color: var(--text-secondary); margin: 0 0 0.5rem 0; }
        .kpi-card .value { font-size: 2.2rem; font-weight: 800; }
        .kpi-card .value.green { color: var(--accent-green); }
        .kpi-card .value.blue { color: var(--accent-blue); }
        .strategy-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .data-table th, .data-table td { padding: 0.75rem; text-align: right; border-bottom: 1px solid var(--border-color); font-size: 0.9rem;}
        .data-table th { color: var(--text-secondary); font-size: 0.8rem; }
        .data-table td { font-weight: 600; }
        .data-table th:first-child, .data-table td:first-child { text-align: left; }
        .yearly-summary-card, .monthly-details-card { grid-column: 1 / -1; }
        .table-container { overflow-x: auto; }
        .summary-table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { padding: 0.75rem; text-align: right; }
        .summary-table th { font-size: 0.9rem; color: var(--text-secondary); }
        .summary-table td:first-child, .summary-table th:first-child { text-align: left; font-weight: 600; font-size: 0.9rem; }
        .summary-table tbody tr { border-top: 1px solid var(--border-color); }
        .summary-table .profit { color: var(--accent-green); }
        .summary-table .loss { color: var(--accent-orange); }
        .chart-card-aum, .chart-card-revenue { grid-column: span 12; }
        .chart-container { height: 300px; position: relative; }
        .year-buttons { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap;}
        .year-btn { background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .year-btn.active { background-color: var(--accent-blue); color: #fff; border-color: var(--accent-blue); }
        .monthly-table { width: 100%; border-collapse: collapse; }
        .monthly-table th, .monthly-table td { padding: 0.75rem; text-align: right; }
        .monthly-table th { font-weight: 600; color: var(--text-secondary); font-size: 0.8rem; }
        .monthly-table th:first-child, .monthly-table td:first-child { text-align: left; font-weight: 600; }
        .monthly-table .profit { color: var(--accent-green); }
        .monthly-table .loss { color: var(--accent-orange); }
        .site-footer { text-align: center; padding: 3rem 1rem 1rem 1rem; color: var(--text-secondary); font-size: 0.9rem; border-top: 1px solid var(--border-color); margin-top: 2rem; }
        .iq-dashboard-container h2, .employee-costs-container h2, .help-container h2, .summary-container h2, .pro-dashboard-container h2 { color: var(--text-primary); }
        .data-table.monthly-table { display: none; } 
        .data-table.monthly-table.active { display: table; }
        .loss { color: var(--accent-orange); }
        .help-container code { background-color: var(--bg-color); padding: 0.2em 0.4em; border-radius: 4px; font-family: 'Courier New', Courier, monospace; }
        .summary-container .monthly-table { font-size: 14px; }
        .summary-container th { background-color: var(--summary-header-bg); text-align: center !important; font-size: 1.1rem !important; }
        .summary-container .section-header { font-weight: 700; background-color: rgba(88, 166, 255, 0.1); }
        .summary-container .sub-item { padding-left: 1.5rem !important; color: var(--text-secondary); }
        .summary-container .total-row, .summary-table .total-row td, .monthly-table .total-row td { background-color: var(--summary-total-bg); font-weight: 700 !important; }
        .summary-container .total-row-final td { background-color: var(--card-bg) !important; font-weight: 800 !important; font-size: 1.1rem !important;}
        .kpi-dashboard-card .metric-group { flex-direction: column; gap: 1.5rem; }
        .kpi-dashboard-card .metric { margin: 0; }
        .kpi-dashboard-card .metric-label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.25rem; font-weight: 500; }
        .kpi-dashboard-card .metric-value { font-size: 2rem; font-weight: 800; line-height: 1.1; }
        .kpi-dashboard-card .metric-value.loss { color: var(--accent-orange); }
        .kpi-dashboard-card .metric-value.profit { color: var(--accent-green); }
        .employee-costs-container .monthly-table tbody tr:nth-of-type(3n) { border-bottom: 2px solid var(--border-color); }
        .employee-costs-container .monthly-table .role-title td { font-weight: 700; background-color: rgba(255,255,255,0.05); }
        .target-list li { margin-bottom: 0.5rem; color: var(--text-secondary); }
        .target-list span { color: var(--text-primary); font-weight: 600; }
        .kpi-definition { color: var(--text-secondary); font-style: italic; font-size: 0.9rem; padding-left: 1rem; }
        .kpi-driver-row { font-weight: 700 !important; background-color: rgba(255,255,255,0.05) !important; }
        .growth-controls input[type="number"], .iq-assumption-card input[type="number"], .pro-assumption-card input[type="number"] { width: 70px; padding: 0.5rem; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 6px; text-align: right; }
        .toggle-switch-container { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem;}
        .toggle-switch-checkbox { height: 0; width: 0; visibility: hidden; }
        .toggle-switch-label { cursor: pointer; text-indent: -9999px; width: 50px; height: 28px; background: grey; display: block; border-radius: 100px; position: relative; }
        .toggle-switch-label::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: #fff; border-radius: 90px; transition: 0.3s; }
        .toggle-switch-checkbox:checked + .toggle-switch-label { background: var(--accent-blue); }
        .toggle-switch-checkbox:checked + .toggle-switch-label::after { left: calc(100% - 3px); transform: translateX(-100%); }
        
        @media (min-width: 576px) {
            .kpi-card { grid-column: span 6; }
        }

        @media (min-width: 768px) {
            body { padding: 1rem 2rem; }
            h1 { font-size: 2.5rem; }
            h2 { font-size: 1.75rem; }
            .card { padding: 1.5rem; }
            .slider-control { width: auto; }
            .kpi-dashboard-card .metric-group { flex-direction: row; }
        }

        @media (min-width: 992px) {
            .kpi-card { grid-column: span 3; }
            .strategy-grid, .pro-assumption-grid, .iq-assumption-grid { grid-template-columns: repeat(2, 1fr); }
            .chart-card-aum { grid-column: span 5; }
            .chart-card-revenue { grid-column: span 7; }
        }
        
        @media (min-width: 1200px) {
            h1 { font-size: 3rem; }
            .strategy-grid { grid-template-columns: repeat(3, 1fr); }
            .iq-assumption-grid > .card, .pro-assumption-grid > .card { grid-column: span 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Quantix Interactive GTM Dashboard</h1>
            <p class="subtitle">Real-time Financial Modeling for All Quantix Business Units</p>
        </header>
        <div class="controls-container">
            <div class="control-group" id="main-nav-selector">
                <button data-action="set-market" data-value="summary" class="control-btn">Summary</button>
                <button data-action="set-market" data-value="marketplace" class="control-btn">Marketplace</button>
                <button data-action="set-market" data-value="iq" class="control-btn">IQ</button>
                <button data-action="set-market" data-value="pro" class="control-btn">Pro</button>
                <button data-action="set-market" data-value="people_and_budget" class="control-btn">People & Budget</button>
                <button data-action="set-market" data-value="model_formulas" class="control-btn">Model Formulas</button>
            </div>
             <div class="control-group">
                <button data-action="reset-all" class="control-btn" style="color: var(--accent-orange);">Reset All to Defaults</button>
            </div>
        </div>
        <main id="dashboard-content"></main>
        <footer class="site-footer">
            <p>&copy; 2020 - 2025 <a href="https://quantix.finance" target="_blank">quantix.finance</a> | All Rights Reserved. This document contains confidential and proprietary information.</p>
        </footer>
    </div>
    
    <!-- TEMPLATES -->
    <template id="template-summary">
         <div class="summary-container">
            <section>
                <h2>Revenues</h2>
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 12;">
                        <div class="chart-container">
                            <canvas id="revenueBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <h2>5 year Financial Plan</h2>
                <div class="card">
                    <div class="table-container">
                        <table class="summary-table" id="summary-income-statement"></table>
                    </div>
                </div>
            </section>
             <section>
                <h2>Key Performance Indicators (KPIs)</h2>
                 <div class="card">
                    <div id="eoy-kpi-table" class="table-container"></div>
                </div>
            </section>
            <section>
                <h2>Funding & Cash Flow</h2>
                 <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 12;">
                         <div class="chart-container">
                            <canvas id="quarterlyCashFlowChart"></canvas>
                        </div>
                    </div>
                    <!-- FIX: Adjusted grid-column to make this card full-width on all screen sizes -->
                    <div class="card kpi-dashboard-card" style="grid-column: span 12;">
                        <h3 style="text-align:center; color: var(--text-secondary); font-weight: 600;">Funding Requirements</h3>
                        <div id="funding-kpis" class="metric-group"></div>
                        <h3 style="text-align:center; margin-top: 1.5rem; color: var(--text-secondary); font-weight: 600;">Quarterly Cash Flow (First 2 Years)</h3>
                        <div id="quarterly-cash-flow-table" class="table-container"></div>
                    </div>
                </div>
            </section>
        </div>
    </template>

    <template id="template-marketplace">
        <div class="gtm-container">
            <div class="controls-container" style="margin-bottom: 1rem; justify-content: flex-start;">
                <div class="control-group">
                    <div id="gtm-market-selector">
                        <button data-action="update-gtm-market" data-value="crypto" class="control-btn active">Crypto</button>
                        <button data-action="update-gtm-market" data-value="forex" class="control-btn">Forex</button>
                    </div>
                </div>
                 <div class="control-group">
                    <div class="toggle-switch-container">
                        <span style="font-weight:600; color:var(--text-secondary);">S-Curve</span>
                        <input type="checkbox" class="toggle-switch-checkbox" id="growth-model-toggle" data-action="update-growth-model">
                        <label class="toggle-switch-label" for="growth-model-toggle">Toggle</label>
                        <span style="font-weight:600; color:var(--text-secondary);">Linear</span>
                    </div>
                </div>
                <div class="control-group" id="gtm-sliders">
                    <div class="slider-control">
                        <label for="aum-slider">Avg. AUM per Copier</label>
                        <input type="range" id="aum-slider" min="500" max="10000" value="2000" step="500">
                        <span id="aum-value">$2000</span>
                    </div>
                    <div class="slider-control">
                        <label for="return-slider">Monthly Bot Return</label>
                        <input type="range" id="return-slider" min="1" max="10" value="3" step="0.5">
                        <span id="return-value">3.0%</span>
                    </div>
                </div>
            </div>
            <div id="gtm-content">
                 <section id="kpis">
                    <h2 id="kpi-title">Key Performance Indicators</h2>
                    <div class="dashboard-grid">
                        <div class="card kpi-card"><h3>Year 5 Total Copiers</h3><p class="value blue" id="kpi-copiers"></p></div>
                        <div class="card kpi-card"><h3>Year 5 Net Profit</h3><p class="value green" id="kpi-profit"></p></div>
                        <div class="card kpi-card"><h3>Total Net Profit</h3><p class="value green" id="kpi-total-profit"></p></div>
                        <div class="card kpi-card"><h3>Break-Even Year</h3><p class="value" id="kpi-breakeven"></p></div>
                    </div>
                </section>
                <section id="strategy">
                    <h2 id="strategy-title">Go-To-Market Strategy</h2>
                    <div class="dashboard-grid">
                        <div class="card" style="grid-column: span 12;">
                            <h3>The Bot-Centric GTM Model</h3>
                            <p style="color:var(--text-secondary); margin:0;">Our growth is driven by deploying 40 high-performance bots on each partner platform. User acquisition is fueled by influencer marketing and a strong reputation on these marketplaces. This model includes a critical **3-month incubation period** for each new partnership, where costs are incurred but revenue generation is delayed, ensuring a realistic cash flow projection.</p>
                        </div>
                        <div class="card strategy-grid" style="grid-column: span 12;">
                            <div>
                                <h3>Deployment Plan</h3>
                                <div class="table-container"><table class="data-table" style="display:table;">
                                    <thead><tr><th>Quarter</th><th>New Partners Added</th><th>Total Partners</th><th>Total Active Bots</th></tr></thead>
                                    <tbody id="deployment-table-body"></tbody>
                                </table></div>
                            </div>
                            <div id="growth-engine-card">
                                <h3>User Growth Engine</h3>
                                <div class="table-container"><table class="data-table" style="display:table;">
                                    <thead><tr><th>Year</th><th>Avg. Copiers / Bot (EOY)</th></tr></thead>
                                    <tbody id="copier-growth-table-body"></tbody>
                                </table></div>
                                
                                <div class="growth-controls" id="s-curve-controls" style="margin-top: 1.5rem;">
                                    <h4 style="margin-top:0; color:var(--text-secondary); font-weight:600;">S-Curve Model Parameters</h4>
                                    <div class="table-container">
                                        <table class="data-table" style="display:table; margin-top:0;">
                                            <thead><tr><th>Year</th><th>MoM Growth (%)</th><th>MoM Churn (%)</th></tr></thead>
                                            <tbody>
                                                <tr><td>Year 1</td><td><input type="number" id="g-y1" step="0.5"></td><td><input type="number" id="c-y1" step="0.5"></td></tr>
                                                <tr><td>Year 2</td><td><input type="number" id="g-y2" step="0.5"></td><td><input type="number" id="c-y2" step="0.5"></td></tr>
                                                <tr><td>Year 3</td><td><input type="number" id="g-y3" step="0.5"></td><td><input type="number" id="c-y3" step="0.5"></td></tr>
                                                <tr><td>Year 4</td><td><input type="number" id="g-y4" step="0.5"></td><td><input type="number" id="c-y4" step="0.5"></td></tr>
                                                <tr><td>Year 5</td><td><input type="number" id="g-y5" step="0.5"></td><td><input type="number" id="c-y5" step="0.5"></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="growth-controls" id="linear-model-controls" style="display: none; margin-top: 1.5rem;">
                                    <h4 style="margin-top:0; color:var(--text-secondary); font-weight:600;">Linear Model Parameters</h4>
                                    <div>
                                        <label for="linear-copiers-input" style="display: block; color: var(--text-secondary); margin-bottom: 0.5rem; font-weight: 600;">New Copiers / Mature Partner / Month</label>
                                        <input type="number" id="linear-copiers-input" step="1">
                                    </div>
                                </div>

                                <button data-action="rerun-gtm-model" class="control-btn" style="background-color: var(--accent-blue); color: #fff; margin-top: 1.5rem; width: 100%;">Update Projections</button>
                            </div>
                            <div>
                                <h3>Key Financial Assumptions</h3>
                                <div class="table-container"><table class="data-table" style="display:table;">
                                    <thead><tr><th>Metric</th><th>Value</th></tr></thead>
                                    <tbody id="financial-assumptions-table-body"></tbody>
                                </table></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="charts">
                    <h2>Performance Visualization</h2>
                    <div class="dashboard-grid">
                        <div class="card chart-card-aum"><div class="chart-container"><canvas id="aumChart"></canvas></div></div>
                        <div class="card chart-card-revenue"><div class="chart-container"><canvas id="revenueChart"></canvas></div></div>
                    </div>
                </section>
                <section id="monthly-projections">
                    <h2>Detailed Monthly Projections</h2>
                    <div class="year-buttons" id="marketplace-year-buttons"></div>
                    <div class="card" style="grid-column: span 12;">
                        <div class="table-container">
                            <table class="data-table" style="display:table;">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Active Partners</th>
                                        <th>Copiers / Bot</th>
                                        <th>Total Copiers</th>
                                        <th>AUM</th>
                                        <th>Gross Revenue</th>
                                        <th>Net Profit/Loss</th>
                                    </tr>
                                </thead>
                                <tbody id="monthly-projections-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </template>
    
    <template id="template-iq">
        <div class="iq-dashboard-container">
             <header>
                <h2 style="font-size: 2.5rem; text-align: center; border-bottom: none; padding-bottom: 0.5rem; margin-bottom: 0;">Quantix IQ - Financial Dashboard</h2>
                <p class="subtitle" style="margin-bottom:1.5rem;">Freemium SaaS model with 1-month free trial period.</p>
            </header>
             <section>
                <h2>1. Core Assumptions & Model Parameters</h2>
                <div class="dashboard-grid iq-assumption-grid">
                    <div class="card iq-assumption-card">
                        <h3>Growth & Conversion</h3>
                        <div class="table-container">
                            <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Metric</th><th>Year 1</th><th>Year 2</th><th>Year 3-5</th></tr></thead>
                                <tbody>
                                    <tr><td>New Free Trials / Month</td>
                                        <td><input type="number" id="iq-trials-y1"></td>
                                        <td><input type="number" id="iq-trials-y2"></td>
                                        <td><input type="number" id="iq-trials-y3"></td>
                                    </tr>
                                    <tr><td>Free-to-Paid Conv. Rate (%)</td>
                                        <td><input type="number" id="iq-conv-y1"></td>
                                        <td><input type="number" id="iq-conv-y2"></td>
                                        <td><input type="number" id="iq-conv-y3"></td>
                                    </tr>
                                    <tr><td>Annual Paid Churn Rate (%)</td>
                                        <td><input type="number" id="iq-churn-y1"></td>
                                        <td><input type="number" id="iq-churn-y2"></td>
                                        <td><input type="number" id="iq-churn-y3"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card iq-assumption-card">
                        <h3>Acquisition & Plan Uptake</h3>
                        <div class="table-container">
                            <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Action</th><th>Cost / Rate</th></tr></thead>
                                <tbody>
                                    <tr><td><b>Cost per Free Trial User ($)</b></td>
                                        <td><input type="number" id="iq-cost-per-trial" style="width: 100px;"></td>
                                    </tr>
                                    <tr style="background-color:rgba(255,255,255,0.05);">
                                        <td>Annual Plan Uptake (%)</td>
                                        <td><input type="number" id="iq-annual-uptake" style="width: 100px;"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                     <div class="card iq-assumption-card">
                        <!-- FIX: Renamed title from "Subscription & Revenue" to "Subscription" -->
                        <h3>Subscription</h3>
                         <div class="table-container"><table class="data-table" style="display:table; margin-top:0;"><thead><tr><th>Plan</th><th>Monthly Cost</th><th>Annual Cost (Billed Upfront)</th></tr></thead><tbody><tr><td>Basic</td><td>$42.00</td><td>$360.00 ($30/mo)</td></tr><tr><td>Pro</td><td>$70.00</td><td>$600.00 ($50/mo)</td></tr><tr><td>Elite</td><td>$210.00</td><td>$1,800.00 ($150/mo)</td></tr></tbody></table></div>
                         <h3 style="margin-top:1.5rem">New Paid User Mix</h3>
                        <div class="table-container"><table class="data-table" style="display:table; margin-top:0;"><thead><tr><th>Year</th><th>Basic</th><th>Pro</th><th>Elite</th></tr></thead><tbody><tr><td>Year 1-5</td><td>60%</td><td>30%</td><td>10%</td></tr></tbody></table></div>
                    </div>
                    <div class="card iq-assumption-card">
                        <h3>Infrastructure Costs & Rules</h3>
                        <div class="table-container"><table class="data-table" style="display:table; margin-top:0;"><thead><tr><th>Item</th><th>Cost/Capacity</th></tr></thead><tbody><tr><td>Shared Server</td><td>$202.40 / month</td></tr><tr><td>Storage Server</td><td>$165.00 / 60 TB</td></tr><tr><td>Bot Server</td><td>$110.00 / 90 Bots</td></tr></tbody></table></div>
                        <h3 style="margin-top:1.5rem;">Server Requirements per User</h3>
                         <div class="table-container"><table class="data-table" style="display:table; margin-top:0;"><thead><tr><th>Plan</th><th>Users/Shared Srv</th><th>Storage</th><th>Bots</th></tr></thead><tbody><tr><td>Free</td><td>500</td><td>2 GB</td><td>0</td></tr><tr><td>Basic</td><td>200</td><td>10 GB</td><td>1</td></tr><tr><td>Pro</td><td>100</td><td>20 GB</td><td>2</td></tr><tr><td>Elite</td><td>50</td><td>50 GB</td><td>5</td></tr></tbody></table></div>
                    </div>
                    <div class="card" style="grid-column: span 12; padding-top: 1rem; padding-bottom: 1rem;">
                         <button data-action="rerun-iq-model" class="control-btn" style="background-color: var(--accent-blue); color: #fff; width: 100%;">Update Projections</button>
                    </div>
                </div>
            </section>
            <section>
                <h2>2. 5-Year Financial Summary</h2>
                <div class="card yearly-summary-card"><div class="table-container">
                    <table class="summary-table" id="iq-yearly-summary"></table>
                </div></div>
            </section>
             <section>
                <h2>3. Monthly Data Breakdowns</h2>
                 <div class="year-buttons" id="year-buttons"></div>
                <div class="card monthly-details-card" style="margin-top:1.5rem; padding: 1.5rem 0 0 0;">
                    <div style="padding: 0 2rem;"><h3>Monthly User Funnel</h3></div>
                    <div class="table-container" id="iq-users-tables"></div>
                </div>
            </section>
        </div>
    </template>

    <template id="template-pro">
        <div class="pro-dashboard-container">
             <header>
                <h2 style="font-size: 2.5rem; text-align: center; border-bottom: none; padding-bottom: 0.5rem; margin-bottom: 0;">Quantix Pro - Institutional Dashboard</h2>
                <p class="subtitle" style="margin-bottom:1.5rem;">Enterprise B2B model for high-value institutional clients.</p>
            </header>
            <section>
                <h2>1. Core Assumptions & Deal Flow</h2>
                <div class="dashboard-grid pro-assumption-grid">
                    <div class="card pro-assumption-card">
                        <h3>Pricing & Monetization</h3>
                        <div class="table-container">
                            <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Tier</th><th>One-Time NRE Fee ($)</th><th>Annual License Fee ($)</th></tr></thead>
                                <tbody>
                                    <tr><td><b>Pro</b> (Small Funds)</td><td><input type="number" id="pro-nre-pro"></td><td><input type="number" id="pro-license-pro"></td></tr>
                                    <tr><td><b>Enterprise</b> (Institutions)</td><td><input type="number" id="pro-nre-ent"></td><td><input type="number" id="pro-license-ent"></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card pro-assumption-card">
                        <h3>Projected New Contracts Per Year</h3>
                        <div class="table-container">
                            <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Year</th><th>New Pro Contracts</th><th>New Enterprise Contracts</th></tr></thead>
                                <tbody>
                                    <tr><td>Year 1</td><td><input type="number" id="pro-deals-pro-y1"></td><td><input type="number" id="pro-deals-ent-y1"></td></tr>
                                    <tr><td>Year 2</td><td><input type="number" id="pro-deals-pro-y2"></td><td><input type="number" id="pro-deals-ent-y2"></td></tr>
                                    <tr><td>Year 3</td><td><input type="number" id="pro-deals-pro-y3"></td><td><input type="number" id="pro-deals-ent-y3"></td></tr>
                                    <tr><td>Year 4</td><td><input type="number" id="pro-deals-pro-y4"></td><td><input type="number" id="pro-deals-ent-y4"></td></tr>
                                    <tr><td>Year 5</td><td><input type="number" id="pro-deals-pro-y5"></td><td><input type="number" id="pro-deals-ent-y5"></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                     <div class="card pro-assumption-card">
                        <h3>Affiliate Program Assumptions</h3>
                        <div class="table-container">
                             <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Metric</th><th>Value</th></tr></thead>
                                <tbody>
                                    <tr><td>Adoption Rate (% of Pro Users)</td><td><input type="number" id="pro-aff-adoption"></td></tr>
                                    <tr><td>Avg. Copiers per Affiliate</td><td><input type="number" id="pro-aff-copiers"></td></tr>
                                    <tr><td>Avg. AUM per Copier ($)</td><td><input type="number" id="pro-aff-aum"></td></tr>
                                    <tr><td><b>Quantix Profit Share (%)</b></td><td><input type="number" id="pro-aff-share"></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card pro-assumption-card">
                        <h3>Server Cost Assumptions</h3>
                        <div class="table-container">
                             <table class="data-table" style="display:table; margin-top:0;">
                                <thead><tr><th>Metric</th><th>Monthly Cost ($)</th></tr></thead>
                                <tbody>
                                    <tr><td>Cost / Pro Client</td><td><input type="number" id="pro-server-pro"></td></tr>
                                    <tr><td>Cost / Enterprise Client</td><td><input type="number" id="pro-server-ent"></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card" style="grid-column: span 12; padding-top: 1rem; padding-bottom: 1rem;">
                         <button data-action="rerun-pro-model" class="control-btn" style="background-color: var(--accent-blue); color: #fff; width: 100%;">Update Projections</button>
                    </div>
                </div>
            </section>
            <section>
                <h2>2. 5-Year Financial Summary</h2>
                <div class="card yearly-summary-card"><div class="table-container">
                    <table class="summary-table" id="pro-yearly-summary"></table>
                </div></div>
            </section>
             <section>
                <h2>3. Monthly Deal Flow & Revenue</h2>
                 <div class="year-buttons" id="pro-year-buttons"></div>
                <div class="card monthly-details-card" style="margin-top:1.5rem; padding: 1.5rem 0 0 0;">
                    <div class="table-container" id="pro-monthly-tables"></div>
                </div>
            </section>
        </div>
    </template>
    
    <template id="template-people_and_budget">
        <div class="employee-costs-container">
            <section>
                <h2>Yearly OpEx Breakdown</h2>
                <div class="card" style="grid-column: span 12;">
                    <div class="chart-container" style="height: 450px;">
                        <canvas id="opexChart"></canvas>
                    </div>
                </div>
            </section>
            <section>
                <h2>Hiring Plan & Base Compensation</h2>
                 <p style="color:var(--text-secondary); margin-top:-1.5rem; max-width: 900px;">This section outlines the static assumptions used to drive the dynamic operating expense calculations.</p>
                <div class="dashboard-grid">
                    <div class="card" style="grid-column: span 12;">
                        <div class="table-container">
                            <table class="monthly-table" id="hiring-plan-table"></table>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <h2>Salary Adjustments vs. Base</h2>
                 <p style="font-size: 0.9rem; font-style: italic; color: var(--text-secondary); margin-top:-1.5rem;">Adjustment Percentages are calculated based on Timing of FTE; Partial staff/service and/or Geo-Location of FTE/Service</p>
                 <div class="card" style="grid-column: span 12;">
                    <div class="table-container">
                        <table class="monthly-table" style="font-size:12px;" id="salary-adjustment-table"></table>
                    </div>
                </div>
            </section>
            <section>
                <h2>General Budget</h2>
                 <div class="card" style="grid-column: span 12;">
                     <div class="table-container">
                        <table class="monthly-table" id="general-budget-table"></table>
                    </div>
                </div>
            </section>
            <section>
                 <h2>Calculated Monthly Operating Expenses</h2>
                 <p style="font-size: 0.9rem; font-style: italic; color: var(--text-secondary); margin-top:-1.5rem;">all salaries are based on salary base*adjustment</p>
                 <div class="year-buttons" id="opex-year-buttons"></div>
                <div class="card" style="grid-column: span 12;">
                    <div class="table-container"><table class="monthly-table" id="opex-details-table"></table></div>
                </div>
            </section>
        </div>
    </template>
    
    <template id="template-model_formulas">
        <div class="help-container">
            <section>
            <h2>Model Formulas & Logic</h2>
            <div class="card" style="grid-column: span 12; margin-bottom:1.5rem;">
                <h3>Summary (Income Statement) Model</h3>
                <p style="color:var(--text-secondary);">This model provides the highest-level financial overview by aggregating the revenues and costs from all other business units (Marketplace, IQ, Pro) and subtracting the company-wide Operating Expenses calculated in the People & Budget model. It is the final roll-up of all other models.</p>
                <ul>
                    <li><strong>Total Revenue:</strong> <code>(Marketplace Gross Revenue) + (IQ Subscription Revenue) + (Pro License & Affiliate Revenue)</code></li>
                    <li><strong>Total Direct Costs:</strong> <code>(Marketplace Direct Costs) + (IQ Acquisition & Infrastructure Costs) + (Pro Server Costs)</code></li>
                    <li><strong>Gross Profit:</strong> <code>Total Revenue - Total Direct Costs</code></li>
                    <li><strong>Total Operating Expenses:</strong> The complete monthly cost from the People & Budget model. This includes all payroll, benefits, taxes, recruiting fees, bonuses, and general & administrative (G&A) expenses.</li>
                    <li><strong>Net Income (Profit/Loss):</strong> <code>Gross Profit - Total Operating Expenses</code></li>
                </ul>
            </div>
             <div class="card" style="grid-column: span 12; margin-bottom:1.5rem;">
                <h3>People & Budget Model</h3>
                <p style="color:var(--text-secondary);">This is a dynamic, bottom-up model where all company-wide operating costs are calculated monthly. The primary driver is the hiring plan, which specifies when each employee (FTE) is hired. All other costs are derived from the number of active FTEs each month.</p>
                <ul>
                    <li><strong>Monthly Payroll:</strong> Calculated for each active employee based on their hire date (DOH). Formula: <code>(Base Salary * (1 + Salary Adjustment %)) / 12</code>. The adjustment percentage can be negative in early years to reflect ramp-up periods.</li>
                    <li><strong>Benefits & Taxes:</strong> A flat percentage of the total monthly payroll. Formula: <code>Total Monthly Payroll * Benefits & Tax Rate (e.g., 25%)</code>.</li>
                    <li><strong>Recruiting Fees:</strong> A one-time cost incurred in an employee's month of hire (or spread across the preceding months). It applies only to C-Level and Sales roles and is calculated as a percentage of the annual base salary. Formula: <code>Base Salary * Recruiting Fee Tier %</code>.</li>
                    <li><strong>Guaranteed Sales Bonus:</strong> A fixed monthly bonus paid to new sales hires for their first 6 months.</li>
                     <li><strong>General & Administrative (G&A):</strong> These are per-employee costs. The model calculates the total based on active FTEs each month. Example Formula for Travel: <code>(Annual Travel Budget per FTE / 12) * Active FTEs</code>.</li>
                    <li><strong>Total Operating Expenses:</strong> The monthly sum of all the above: <code>Payroll + Benefits & Taxes + Recruiting Fees + Sales Bonuses + G&A Costs</code>.</li>
                </ul>
            </div>
            <div class="card" style="grid-column: span 12; margin-bottom:1.5rem;">
                <h3>Marketplace Model (Crypto / Forex)</h3>
                <p style="color: var(--text-secondary);">This model projects revenue and costs from deploying trading bots on third-party partner platforms (e.g., Crypto exchanges, Forex brokers). The core driver is the number of "copiers" — users on those platforms who copy our bot strategies.</p>
                <ul>
                    <li><strong>User Growth (Copiers):</strong> Can be modeled in two ways:
                        <ul>
                           <li><strong>S-Curve:</strong> Assumes exponential growth in early stages that slows down as the market matures. Formula: <code>New Copiers = Previous Month's Copiers * (1 + MoM Growth % - MoM Churn %)</code>.</li>
                           <li><strong>Linear:</strong> Assumes a steady number of new copiers per partner each month. Formula: <code>New Copiers = # of Mature Partners * New Copiers per Partner per Month</code>.</li>
                        </ul>
                    </li>
                    <li><strong>Revenue AUM:</strong> The total assets under management that generate revenue. This is based on the number of copiers on partner platforms that have passed their 3-month incubation period.</li>
                    <li><strong>Gross Revenue:</strong> <code>Revenue AUM * Monthly Bot Return % * Quantix Profit Share % (12%)</code></li>
                    <li><strong>Direct Costs:</strong> Includes annual marketing budget and a one-time investment cost for deploying bots to a new partner platform. Formula: <code>(Annual Marketing / 12) + (Total Bot Investment / 12)</code> (spread over the year of deployment).</li>
                </ul>
            </div>
            <div class="card" style="grid-column: span 12; margin-bottom:1.5rem;">
                <h3>IQ Model (Freemium SaaS)</h3>
                <p style="color: var(--text-secondary);">This model simulates a standard freemium Software-as-a-Service (SaaS) funnel for our Quantix IQ platform. It models the flow of users from free trials to paid subscriptions and calculates associated revenue and costs.</p>
                 <ul>
                    <li><strong>User Funnel:</strong>
                        <ul>
                            <li><strong>New Paid Users (Conversions):</strong> <code>(Free Users from Previous Month) * (Free-to-Paid Conversion Rate %)</code></li>
                            <li><strong>Total Paid MAU (Monthly Active Users):</strong> <code>(Previous Month's Paid Users * (1 - Monthly Churn %)) + New Paid Users</code></li>
                        </ul>
                    </li>
                    <li><strong>Subscription Revenue:</strong> Calculated based on the mix of users on Basic, Pro, and Elite plans, and whether they choose monthly or annual billing. Annual subscriptions provide upfront cash but are recognized as 1/12 of the revenue each month (MRR).</li>
                    <li><strong>Direct Costs:</strong>
                        <ul>
                            <li><strong>Acquisition Cost:</strong> The cost to acquire a new free trial user. Formula: <code>New Free Trials * Cost per Free Trial User</code>.</li>
                            <li><strong>Infrastructure Costs:</strong> Server, storage, and bot costs that scale with the number and type of active users (Free, Basic, Pro, Elite).</li>
                        </ul>
                    </li>
                </ul>
            </div>
             <div class="card" style="grid-column: span 12; margin-bottom:1.5rem;">
                <h3>Pro Model (Institutional B2B)</h3>
                <p style="color: var(--text-secondary);">This is a direct sales model for our high-value institutional products. It's based on closing a set number of large contracts per year, plus revenue from a related affiliate program.</p>
                <ul>
                    <li><strong>License Revenue:</strong> Generated from two fees: a one-time Non-Recurring Engineering (NRE) fee for setup and a recurring Annual License Fee.</li>
                    <li><strong>Affiliate Revenue:</strong> A profit-sharing model where Pro clients can run their own bots on our infrastructure and share the profits with us. Formula: <code>(# Affiliates) * (Copiers/Affiliate) * (AUM/Copier) * (Monthly Return %) * (Quantix Profit Share %)</code></li>
                    <li><strong>Direct Costs:</strong> These are primarily server costs.
                        <ul>
                            <li><strong>Client Server Costs:</strong> A fixed monthly hosting fee for each active Pro and Enterprise client.</li>
                            <li><strong>Affiliate Bot Server Costs:</strong> A dynamic cost based on the number of bots run by affiliates. Formula: <code>(Total Affiliate Bots / 90) * $110</code>.</li>
                        </ul>
                    </li>
                </ul>
            </div>
            </section>
        </div>
    </template>

    <script>
    /**
     * @file Manages the Quantix Interactive Financial Dashboard.
     * @version 18.1
     * @description This version updates titles and layout based on user feedback.
     */
    
    // --- GLOBAL STATE AND CONFIGURATION ---
    const START_YEAR = 2025;
    let charts = {};
    let GTM_PARAMS = {}, IQ_PARAMS = {}, PRO_PARAMS = {};
    let GTM_DEFAULTS_CRYPTO = {}, GTM_DEFAULTS_FOREX = {}, IQ_DEFAULTS = {}, PRO_DEFAULTS = {}, PEOPLE_DEFAULTS = {};

    // --- UTILITY FUNCTIONS ---
    const formatCurrency = (value, compact = false) => {
        if (value === 'N/A' || typeof value !== 'number') return 'N/A';
        const sign = value < 0 ? '-' : '';
        const absValue = Math.abs(value);
        if (compact) {
            if (absValue >= 1e6) return `${sign}${(absValue / 1e6).toFixed(1)}M`;
            if (absValue >= 1e3) return `${sign}${(absValue / 1e3).toFixed(0)}K`;
            return `${sign}$${Math.round(absValue)}`;
        }
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
    };
    const formatNumber = (value) => {
        if (typeof value !== 'number') return '0';
        return Math.round(value).toLocaleString('en-US');
    };
    const createYearButtons = (containerId, years, actionName) => {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = years.map((year, index) => 
            `<button data-action="${actionName}" data-value="${year}" class="year-btn ${index === 0 ? 'active' : ''}">Year ${year}</button>`
        ).join('');
    };

    // --- DATA CALCULATION MODELS ---
    
    function calculateGTMModel(inputs) {
        const { market, aumPerUser, monthlyReturn, growthModelType, customParams, linearNewCopiersPerPartner } = inputs;
        const isCrypto = market === 'crypto';
        const profitShare = 0.12; const botsPerPartner = 40;
        const partnerCount = isCrypto ? 15 : 20; const totalBotInvestment = partnerCount * botsPerPartner * 1000;
        const growthModel = customParams.growthModel;
        const marketingCosts = isCrypto ? {1:150000,2:150000,3:150000,4:150000,5:150000} : {1:0,2:150000,3:150000,4:150000,5:150000};
        
        let partners = []; const rolloutStartYear = isCrypto ? 1 : 2; const partnersPerQuarter = Math.ceil(partnerCount / 4);
        for (let q = 0; q < 4; q++) { const startMonth = (rolloutStartYear - 1) * 12 + (q * 3) + 1; for (let i = 0; i < partnersPerQuarter; i++) { if (partners.length < partnerCount) partners.push({ startMonth }); } }
        
        let monthlyResults = []; let totalCopiers = 0; const copierStartMonth = isCrypto ? 4 : 16;
        for (let m = 1; m <= 60; m++) {
            const maturePartners = partners.filter(p => p.startMonth + 3 <= m).length;
            const companyYear = Math.ceil(m/12);
            const yearGrowth = growthModel[companyYear] || { growth: 0, churn: 0 };
            if (m >= copierStartMonth) {
                if (m === copierStartMonth) { totalCopiers = 50; } else {
                    const prevCopiers = totalCopiers;
                    const churned = prevCopiers * yearGrowth.churn;
                    let gained = 0;
                    if (growthModelType === 'linear') { gained = maturePartners * linearNewCopiersPerPartner; } 
                    else { gained = prevCopiers * yearGrowth.growth; }
                    totalCopiers = prevCopiers - churned + gained;
                }
            }
            const activePartners = partners.filter(p => p.startMonth <= m).length; const totalBots = activePartners * botsPerPartner;
            const revenueCopiers = totalBots > 0 ? (totalCopiers * ((maturePartners * botsPerPartner) / totalBots)) : 0;
            const monthlyGrossRevenue = revenueCopiers * aumPerUser * monthlyReturn * profitShare;
            let monthlyTotalCost = (marketingCosts[companyYear] || 0) / 12; if (companyYear === rolloutStartYear) monthlyTotalCost += totalBotInvestment / 12;
            monthlyResults.push({ month: m, activePartners, copiersPerBot: totalBots > 0 ? totalCopiers / totalBots : 0, totalCopiers, aum: totalCopiers * aumPerUser, revenue: monthlyGrossRevenue, netProfit: monthlyGrossRevenue - monthlyTotalCost });
        }
        const yearly_summary = { users: [], aum: [], revenue: [], costs: [], profit: [] };
        for(let y=1; y<=5; y++){ const yearData = monthlyResults.filter(r=>Math.ceil(r.month/12)===y); if(yearData.length>0){ yearly_summary.users.push(yearData[yearData.length-1].totalCopiers); yearly_summary.aum.push(yearData[yearData.length-1].aum); const y_revenue=yearData.reduce((acc,r)=>acc+r.revenue,0); let y_total_cost=marketingCosts[y]||0; if(y===rolloutStartYear)y_total_cost+=totalBotInvestment; yearly_summary.costs.push(-y_total_cost); yearly_summary.revenue.push(y_revenue); yearly_summary.profit.push(y_revenue-y_total_cost); } else { yearly_summary.users.push(0); yearly_summary.aum.push(0); yearly_summary.revenue.push(0); yearly_summary.costs.push(0); yearly_summary.profit.push(0); } }
        return { yearly_summary, monthly: monthlyResults, partnerCount };
    }
    
    function calculateIQModel(params) {
        const monthlyResults = []; let activeFreeUsers = 0, freeUsersFromLastMonth = 0;
        const paidUsers = { basic: 0, pro: 0, elite: 0 }, monthlySubscribers = { basic: 0, pro: 0, elite: 0 };
        const planDetails = { basic: { monthly: 42, annual: 360 }, pro: { monthly: 70, annual: 600 }, elite: { monthly: 210, annual: 1800 } };
        for (let m = 1; m <= 60; m++) {
            if (m < params.startMonth) { monthlyResults.push({ month: m, newFree: 0, newPaid: 0, paidTotal: 0, freeTotal: 0, revenue: 0, acqCost: 0, mrr: 0 }); continue; }
            const year = Math.ceil(m / 12); const yearKey = year <= 2 ? year : 3;
            const monthlyPaidChurn = 1 - Math.pow(1 - params.annualPaidChurn[yearKey], 1/12);
            for(const plan in paidUsers) paidUsers[plan] *= (1 - monthlyPaidChurn); for(const plan in monthlySubscribers) monthlySubscribers[plan] *= (1 - monthlyPaidChurn);
            const conversions = freeUsersFromLastMonth * params.convRate[yearKey];
            for(const plan in params.paidUserDist){ const newSubs = conversions * params.paidUserDist[plan]; paidUsers[plan] += newSubs; monthlySubscribers[plan] += newSubs * params.planUptake.monthly; }
            const newFreeTrials = params.newFreeTrialsPerMonth[yearKey]; activeFreeUsers += newFreeTrials - freeUsersFromLastMonth; freeUsersFromLastMonth = newFreeTrials;
            const recurringRevenue = Object.keys(planDetails).reduce((sum, plan) => sum + (monthlySubscribers[plan] * planDetails[plan].monthly), 0);
            const newAnnualRevenue = Object.keys(planDetails).reduce((sum, plan) => sum + (conversions * params.paidUserDist[plan] * params.planUptake.annual * planDetails[plan].annual), 0);
            const mrr = recurringRevenue + Object.keys(planDetails).reduce((sum, plan) => sum + ( (conversions * params.paidUserDist[plan] * params.planUptake.annual * planDetails[plan].annual) / 12), 0);
            monthlyResults.push({ month: m, newFree: newFreeTrials, newPaid: conversions, paidTotal: Object.values(paidUsers).reduce((a, b) => a + b, 0), freeTotal: activeFreeUsers, revenue: recurringRevenue + newAnnualRevenue, acqCost: newFreeTrials * params.costPerFreeTrial, mrr: mrr });
        }
        const yearlySummary = { revenue: [], acqCost: [], grossProfit: [], paidUsers: [], mrr:[] };
        for (let y = 1; y <= 5; y++) {
            const yearData = monthlyResults.filter(r => Math.ceil(r.month / 12) === y);
            const revenue = yearData.reduce((acc, r) => acc + r.revenue, 0); const acqCost = yearData.reduce((acc, r) => acc + r.acqCost, 0);
            yearlySummary.revenue.push(revenue); yearlySummary.acqCost.push(acqCost); yearlySummary.grossProfit.push(revenue-acqCost);
            yearlySummary.paidUsers.push(yearData.length > 0 ? yearData[yearData.length - 1].paidTotal : 0);
            yearlySummary.mrr.push(yearData.length > 0 ? yearData[yearData.length - 1].mrr : 0);
        }
        return { monthly: monthlyResults, yearly: yearlySummary };
    }

    function calculateProModel(params) {
        const { pricing, newDealsPerYear, affiliateParams, annualChurnRate, serverCosts } = params;
        let activePro = [], activeEnterprise = []; const monthlyResults = [];
        for (let m = 1; m <= 60; m++) {
            const yearIndex = Math.floor((m - 1) / 12);
            let licenseRevenue = 0, newProDeals = 0, newEnterpriseDeals = 0;
            if (m > 12 && (m-1) % 12 === 0) { activePro = activePro.filter(() => Math.random() > annualChurnRate); activeEnterprise = activeEnterprise.filter(() => Math.random() > annualChurnRate); }
            activePro.forEach(c => { if ((m - c.startMonth) > 0 && (m - c.startMonth) % 12 === 0) licenseRevenue += pricing.pro.license; });
            activeEnterprise.forEach(c => { if ((m - c.startMonth) > 0 && (m - c.startMonth) % 12 === 0) licenseRevenue += pricing.enterprise.license; });
            const proDealsThisYear = newDealsPerYear.pro[yearIndex];
            if (proDealsThisYear > 0 && activePro.filter(c=>Math.ceil(c.startMonth/12)-1===yearIndex).length < proDealsThisYear && m>0 && (12/proDealsThisYear>0) && m % Math.floor(12/proDealsThisYear) === 0) { activePro.push({startMonth:m}); licenseRevenue+=pricing.pro.nre+pricing.pro.license; newProDeals++; }
            const entDealsThisYear = newDealsPerYear.enterprise[yearIndex];
            if (entDealsThisYear > 0 && activeEnterprise.filter(c=>Math.ceil(c.startMonth/12)-1===yearIndex).length < entDealsThisYear && m>0 && (12/entDealsThisYear>0) && m % Math.floor(12/entDealsThisYear) === 0) { activeEnterprise.push({startMonth:m}); licenseRevenue+=pricing.enterprise.nre+pricing.enterprise.license; newEnterpriseDeals++; }
            const affiliateRevenue = activePro.length * affiliateParams.adoptionRate * affiliateParams.avgCopiersPerAffiliate * affiliateParams.avgAumPerCopier * affiliateParams.monthlyBotReturn * affiliateParams.quantixProfitShare;
            const affiliateBotServerCost = (activePro.length * affiliateParams.adoptionRate * 40 / 90) * 110;
            const monthlyServerCost = (activePro.length * serverCosts.pro) + (activeEnterprise.length * serverCosts.enterprise) + affiliateBotServerCost;
            monthlyResults.push({ m, newPro: newProDeals, newEnterprise: newEnterpriseDeals, totalPro: activePro.length, totalEnterprise: activeEnterprise.length, licenseRevenue, affiliateRevenue, revenue: licenseRevenue + affiliateRevenue, serverCost: monthlyServerCost });
        }
        const yearlySummary = { revenue: [], licenseRevenue: [], affiliateRevenue: [], totalPro: [], totalEnterprise: [], costs: [], grossProfit: [] };
        for (let y = 1; y <= 5; y++) {
            const yearData = monthlyResults.filter(r => Math.ceil(r.m / 12) === y);
            const totalRevenue = yearData.reduce((acc, r) => acc + r.revenue, 0);
            const totalCosts = yearData.reduce((acc, r) => acc + r.serverCost, 0);
            yearlySummary.revenue.push(totalRevenue);
            yearlySummary.costs.push(totalCosts);
            yearlySummary.grossProfit.push(totalRevenue - totalCosts);
            yearlySummary.licenseRevenue.push(yearData.reduce((acc, r) => acc + r.licenseRevenue, 0));
            yearlySummary.affiliateRevenue.push(yearData.reduce((acc, r) => acc + r.affiliateRevenue, 0));
            const lastMonthOfYear = yearData.length > 0 ? yearData[yearData.length-1] : {totalPro:0, totalEnterprise:0};
            yearlySummary.totalPro.push(lastMonthOfYear.totalPro); yearlySummary.totalEnterprise.push(lastMonthOfYear.totalEnterprise);
        }
        return { monthly: monthlyResults, yearly: yearlySummary };
    }

    function calculatePeopleAndBudgetModel(params) {
        const monthlyData = Array.from({ length: 60 }, (_, i) => ({
            month: i + 1, payroll: 0, benefitsTaxes: 0,
            recruitingFees: 0, salesBonuses: 0, travel: 0, it: 0, comms: 0,
            totalOpEx: 0, activeFTE: 0
        }));

        params.employees.forEach(emp => {
            // Rule: No recruiting fees in month one (for initial employees).
            if (emp.doh > 1) {
                const isSalesPersonnel = emp.type === 'sales' || emp.role === 'VP of Sales';
                const isCLevel = emp.type === 'cLevel';

                // Rule: Recruiting fees only for C‑level and sales personnel.
                if (isCLevel || isSalesPersonnel) {
                    let feePercentage = 0;
                    if (isCLevel) {
                        feePercentage = params.recruitingFeeTiers.cLevel;
                    } else if (isSalesPersonnel) {
                        // The VP of Sales is a director, so use that tier. Others use standard.
                        feePercentage = (emp.type === 'director') ? params.recruitingFeeTiers.director : params.recruitingFeeTiers.standard;
                    }
                    
                    if (feePercentage > 0) {
                        const recruitingFee = emp.baseSalary * feePercentage;
                        if (emp.recruitingInstallments) {
                            if (emp.doh > 2) monthlyData[emp.doh - 3].recruitingFees += recruitingFee * 0.30;
                            if (emp.doh > 1) monthlyData[emp.doh - 2].recruitingFees += recruitingFee * 0.30;
                            monthlyData[emp.doh - 1].recruitingFees += recruitingFee * 0.40;
                        } else if (emp.doh > 0) {
                             monthlyData[emp.doh - 1].recruitingFees += recruitingFee;
                        }
                    }
                }
            }

            for (let m = emp.doh - 1; m < 60; m++) {
                const yearIndexForLoop = Math.floor(m / 12);
                const loopAdjustedSalary = emp.baseSalary * (1 + emp.adjustments[yearIndexForLoop]);
                monthlyData[m].activeFTE++;
                monthlyData[m].payroll += loopAdjustedSalary / 12;

                if (emp.role === 'Sales' && m < emp.doh - 1 + 6) {
                    monthlyData[m].salesBonuses += params.guaranteedSalesBonus;
                }

                if (emp.type === 'cLevel') monthlyData[m].travel += params.travelBudget.cLevel / 12;
                else if (emp.type === 'director') monthlyData[m].travel += params.travelBudget.director / 12;
                else monthlyData[m].travel += params.travelBudget.standard / 12;
            }
        });

        monthlyData.forEach(month => {
            month.benefitsTaxes = month.payroll * params.benefitsAndTaxRate;
            month.it = month.activeFTE * (params.itPerFTE / 12);
            month.comms = month.activeFTE * (params.commsPerFTE / 12);
            month.totalOpEx = month.payroll + month.benefitsTaxes + month.recruitingFees + month.salesBonuses + month.travel + month.it + month.comms;
        });

        const yearlyTotals = { totalOpEx: [], fte: [] };
        for (let y = 0; y < 5; y++) {
            const yearData = monthlyData.slice(y * 12, (y + 1) * 12);
            yearlyTotals.totalOpEx.push(yearData.reduce((sum, m) => sum + m.totalOpEx, 0));
            yearlyTotals.fte.push(yearData[11].activeFTE);
        }
        
        return { monthlyData, yearlyTotals };
    }

    // --- VIEW RENDERERS & CONTROLLERS ---
    
    function renderChart(chartName, elementId, chartConfig) {
        const chartEl = document.getElementById(elementId);
        if (!chartEl) return;
        if (charts[chartName]) charts[chartName].destroy();
        charts[chartName] = new Chart(chartEl, chartConfig);
    }

    function renderSummaryView() {
        const gtmCryptoData = calculateGTMModel(GTM_PARAMS); 
        const gtmForexData = calculateGTMModel({ ...GTM_PARAMS, market: 'forex', aumPerUser: 1500 });
        const iqData = calculateIQModel(IQ_PARAMS);
        const proData = calculateProModel(PRO_PARAMS);
        const peopleData = calculatePeopleAndBudgetModel(PEOPLE_DEFAULTS);
        
        const totalRevenue = Array.from({length: 5}, (_, i) => gtmCryptoData.yearly_summary.revenue[i] + gtmForexData.yearly_summary.revenue[i] + iqData.yearly.revenue[i] + proData.yearly.revenue[i]);
        const totalDirectCosts = Array.from({length: 5}, (_, i) => Math.abs(gtmCryptoData.yearly_summary.costs[i]) + Math.abs(gtmForexData.yearly_summary.costs[i]) + iqData.yearly.acqCost[i] + proData.yearly.costs[i]);
        const grossProfit = totalRevenue.map((val, i) => val - totalDirectCosts[i]);
        const yearlyNetIncome = grossProfit.map((gp, i) => gp - peopleData.yearlyTotals.totalOpEx[i]);
        
        const monthlyNetIncome = Array.from({length: 60}, (_, i) => {
            const yearIndex = Math.floor(i / 12);
            const monthlyGTMRev = gtmCryptoData.monthly[i].revenue + gtmForexData.monthly[i].revenue;
            const monthlyGTMCost = (Math.abs(gtmCryptoData.yearly_summary.costs[yearIndex]) + Math.abs(gtmForexData.yearly_summary.costs[yearIndex])) / 12;
            return monthlyGTMRev + iqData.monthly[i].revenue + proData.monthly[i].revenue - monthlyGTMCost - iqData.monthly[i].acqCost - proData.monthly[i].serverCost - peopleData.monthlyData[i].totalOpEx;
        });
        const cumulativeNetIncome = monthlyNetIncome.reduce((acc, ni) => { acc.push((acc.length > 0 ? acc[acc.length - 1] : 0) + ni); return acc; }, []);
        
        const peakCashNeed = Math.min(0, ...cumulativeNetIncome);
        document.getElementById('funding-kpis').innerHTML = `<div class="metric"><div class="metric-label">Peak Cumulative Cash Need</div><div class="metric-value loss">${formatCurrency(peakCashNeed)}</div></div><div class="metric"><div class="metric-label">Recommended Target (30% Buffer)</div><div class="metric-value profit">${formatCurrency(Math.abs(peakCashNeed) * 1.3)}</div></div>`;
        
        let quarterlyTableHTML = `<table class="data-table" style="display:table; margin-top:0;"><thead><tr><th>Quarter End</th><th>Quarterly Net</th><th>Cumulative Position</th></tr></thead><tbody>`;
        for (let q = 1; q <= 8; q++) { const endMonthIndex=q*3-1; const quarterlyNet=monthlyNetIncome.slice(endMonthIndex-2,endMonthIndex+1).reduce((a,b)=>a+b,0); quarterlyTableHTML += `<tr><td>Y${Math.ceil(q/4)}-Q${q%4||4}</td><td class="${quarterlyNet<0?'loss':'profit'}">${formatCurrency(quarterlyNet)}</td><td class="${cumulativeNetIncome[endMonthIndex]<0?'loss':'profit'}">${formatCurrency(cumulativeNetIncome[endMonthIndex])}</td></tr>`; }
        document.getElementById('quarterly-cash-flow-table').innerHTML = quarterlyTableHTML+`</tbody></table>`;
        
        document.getElementById('eoy-kpi-table').innerHTML = `<table class="data-table" style="display:table;"><thead><tr><th>Metric (End of Year)</th>${Array.from({length:5},(_,i)=>`<th>Y${i+1}</th>`).join('')}</tr></thead><tbody>
        <tr class="kpi-driver-row"><td colspan="6" style="text-align:left;">Revenue Drivers</td></tr>
        <tr><td>Monthly Recurring Revenue (MRR)<p class="kpi-definition">Total monthly subscription revenue from IQ platform.</p></td>${iqData.yearly.mrr.map(mrr=>`<td>${formatCurrency(mrr)}</td>`).join('')}</tr>
        <tr><td>Revenue AUM<p class="kpi-definition">Total value of user funds managed by Quantix bots.</p></td>${gtmCryptoData.yearly_summary.aum.map((u,i)=>`<td>${formatCurrency(u+gtmForexData.yearly_summary.aum[i])}</td>`).join('')}</tr>
        <tr><td>Paid MAU (IQ)<p class="kpi-definition">Total paying subscribers for the IQ platform.</p></td>${iqData.yearly.paidUsers.map(u=>`<td>${formatNumber(u)}</td>`).join('')}</tr>
        <tr class="kpi-driver-row"><td colspan="6" style="text-align:left;">Supporting Metrics</td></tr>
        <tr><td># Marketplace Copiers</td>${gtmCryptoData.yearly_summary.users.map((u,i)=>`<td>${formatNumber(u+gtmForexData.yearly_summary.users[i])}</td>`).join('')}</tr>
        <tr><td># Pro Contracts</td>${proData.yearly.totalPro.map((p,i)=>`<td>${formatNumber(p+proData.yearly.totalEnterprise[i])}</td>`).join('')}</tr>
        <tr><td># FTE</td>${peopleData.yearlyTotals.fte.map(f=>`<td>${f}</td>`).join('')}</tr>
        <tr class="total-row"><td>Total Revenue</td>${totalRevenue.map(r=>`<td>${formatCurrency(r)}</td>`).join('')}</tr>
        <tr class="total-row loss"><td>Operating Expense</td>${peopleData.yearlyTotals.totalOpEx.map(val=>`<td>(${formatCurrency(val)})</td>`).join('')}</tr>
        </tbody></table>`;
        
        document.getElementById('summary-income-statement').innerHTML = `<thead><tr><th>Income Statement Summary</th>${Array.from({length:5},(_,i)=>`<th>Y${i+1}</th>`).join('')}</tr></thead><tbody><tr class="section-header"><td colspan="6">Revenue</td></tr><tr><td class="sub-item">Marketplace</td>${gtmCryptoData.yearly_summary.revenue.map((val,i)=>`<td>${formatCurrency(val+gtmForexData.yearly_summary.revenue[i])}</td>`).join('')}</tr><tr><td class="sub-item">Quantix IQ</td>${iqData.yearly.revenue.map(val=>`<td>${formatCurrency(val)}</td>`).join('')}</tr><tr><td class="sub-item">Quantix Pro</td>${proData.yearly.revenue.map(val=>`<td>${formatCurrency(val)}</td>`).join('')}</tr><tr class="total-row"><td>Total Revenue</td>${totalRevenue.map(val=>`<td>${formatCurrency(val)}</td>`).join('')}</tr><tr class="section-header"><td colspan="6">Direct Costs</td></tr><tr><td class="sub-item">Marketplace</td>${gtmCryptoData.yearly_summary.costs.map((val,i)=>`<td>(${formatCurrency(Math.abs(val)+Math.abs(gtmForexData.yearly_summary.costs[i]))})</td>`).join('')}</tr><tr><td class="sub-item">Quantix IQ</td>${iqData.yearly.acqCost.map(val=>`<td>(${formatCurrency(val)})</td>`).join('')}</tr><tr><td class="sub-item">Quantix Pro</td>${proData.yearly.costs.map(val=>`<td>(${formatCurrency(val)})</td>`).join('')}</tr><tr class="total-row"><td>Total Direct Costs</td>${totalDirectCosts.map(val=>`<td>(${formatCurrency(val)})</td>`).join('')}</tr><tr><td><strong>Gross Profit</strong></td>${grossProfit.map(val=>`<td class="${val<0?'loss':'profit'}"><strong>${formatCurrency(val)}</strong></td>`).join('')}</tr><tr class="section-header"><td colspan="6">Operating Expenses</td></tr><tr><td class="sub-item">Total Operating Expenses</td>${peopleData.yearlyTotals.totalOpEx.map(val=>`<td>(${formatCurrency(val)})</td>`).join('')}</tr><tr class="total-row-final"><td><strong>Net Income</strong></td>${yearlyNetIncome.map(val=>`<td class="${val<0?'loss':'profit'}"><strong>${formatCurrency(val)}</strong></td>`).join('')}</tr></tbody>`;
        
        const revChartData = { labels:Array.from({length:5},(_,i)=>`${START_YEAR+i}`), datasets:[{label:'Marketplace',data:gtmCryptoData.yearly_summary.revenue.map((v,i)=>v+gtmForexData.yearly_summary.revenue[i]),backgroundColor:'#0077b6'},{label:'Quantix IQ',data:iqData.yearly.revenue,backgroundColor:'#f77829'},{label:'Quantix Pro',data:proData.yearly.revenue,backgroundColor:'#3fb950'}]};
        renderChart('revenueBreakdown', 'revenueBreakdownChart', {type:'bar', data:revChartData, options:{responsive:true,maintainAspectRatio:false,plugins:{title:{display:true,text:'Revenue by Business Unit',color:'#e6edf3',font:{size:18}},legend:{position:'bottom',labels:{color:'#e6edf3'}}},scales:{x:{stacked:true,ticks:{color:'#e6edf3'},grid:{color:'#30363d'}},y:{stacked:true,ticks:{color:'#e6edf3',callback:v=>formatCurrency(v,true)},grid:{color:'#30363d'}}}}});
        
        const quarterlyLabels=Array.from({length:20},(_,i)=>`Y${Math.floor(i/4)+1}-Q${i%4+1}`);
        const milestoneAnnotations={
            'crypto':{type:'line',xMin:0,xMax:0,borderColor:'rgba(88,166,255,0.7)',borderWidth:2,label:{content:'Crypto Partnerships',display:true,position:'start',backgroundColor:'rgba(88,166,255,0.7)'}},
            'iq_launch':{type:'line',xMin:1,xMax:1,borderColor:'rgba(247,120,41,0.7)',borderWidth:2,label:{content:'IQ Launch',display:true,position:'end',backgroundColor:'rgba(247,120,41,0.7)'}},
            'forex_partner':{type:'line',xMin:4,xMax:4,borderColor:'rgba(88,166,255,0.7)',borderWidth:2,label:{content:'Forex Partnerships',display:true,position:'start',backgroundColor:'rgba(88,166,255,0.7)'}},
            'iq_forex':{type:'line',xMin:6,xMax:6,borderColor:'rgba(247,120,41,0.7)',borderWidth:2,label:{content:'IQ Forex Support',display:true,position:'end',backgroundColor:'rgba(247,120,41,0.7)'}}
        };
        const cashFlowChartData={labels:quarterlyLabels,datasets:[{label:'Quarterly Net Income',data:Array.from({length:20},(_,i)=>monthlyNetIncome.slice(i*3,i*3+3).reduce((a,b)=>a+b,0)),borderColor:'rgba(88,166,255,1)',backgroundColor:'rgba(88,166,255,0.2)',fill:true,tension:0.1}]};
        renderChart('cashFlow','quarterlyCashFlowChart',{type:'line',data:cashFlowChartData,options:{responsive:true,maintainAspectRatio:false,plugins:{title:{display:true,text:'Quarterly Cash Flow & Milestones',color:'#e6edf3',font:{size:18}},legend:{display:false},annotation:{annotations:milestoneAnnotations}},scales:{y:{ticks:{color:'#e6edf3',callback:v=>formatCurrency(v,true)},grid:{color:'#30363d'}},x:{ticks:{color:'#e6edf3'},grid:{color:'#30363d'}}}}});
    }

    function renderPeopleAndBudgetView() {
        const data = calculatePeopleAndBudgetModel(PEOPLE_DEFAULTS);
        
        let hiringPlanHTML = `<thead><tr><th>Position</th><th>Base Salary</th><th>Year 1</th><th>Year 2</th><th>Year 3</th><th>Year 4</th><th>Year 5</th></tr></thead><tbody>`;
        const yearlyTotals = Array(5).fill(0);
        for (const role in PEOPLE_DEFAULTS.hiringPlan) { 
            const baseSalary = PEOPLE_DEFAULTS.employees.find(e => e.role === role)?.baseSalary || 0;
            hiringPlanHTML += `<tr><td>${role}</td><td>${formatCurrency(baseSalary)}</td>`;
            PEOPLE_DEFAULTS.hiringPlan[role].forEach((count, index) => {
                hiringPlanHTML += `<td>${count}</td>`;
                yearlyTotals[index] += count;
            });
            hiringPlanHTML += `</tr>`;
        }
        hiringPlanHTML += `<tr class="total-row"><td><strong>Total</strong></td><td>-</td>${yearlyTotals.map(total => `<td><strong>${total}</strong></td>`).join('')}</tr>`;
        document.getElementById('hiring-plan-table').innerHTML = hiringPlanHTML + `</tbody>`;

        let adjustmentHTML = `<thead><tr><th>Position</th><th>Year 1 Adj.</th><th>Year 2 Adj.</th><th>Year 3 Adj.</th><th>Year 4 Adj.</th><th>Year 5 Adj.</th></tr></thead><tbody>`;
        for (const role in PEOPLE_DEFAULTS.salaryAdjustments) { adjustmentHTML += `<tr><td>${role}</td>${PEOPLE_DEFAULTS.salaryAdjustments[role].map(adj => `<td class="${adj > 0 ? 'profit' : adj < 0 ? 'loss' : ''}">${(adj * 100).toFixed(0)}%</td>`).join('')}</tr>`; }
        document.getElementById('salary-adjustment-table').innerHTML = adjustmentHTML + `</tbody>`;
        
        let budgetHTML = `<thead><tr><th>Cost Centre</th><th>Annual</th></tr></thead><tbody>`;
        for (const item in PEOPLE_DEFAULTS.generalBudget) { budgetHTML += `<tr><td>${item.replace(/([A-Z])/g, ' $1').trim()}</td><td>${PEOPLE_DEFAULTS.generalBudget[item] === 'Tiered' ? 'Tiered' : formatCurrency(PEOPLE_DEFAULTS.generalBudget[item])}</td></tr>`; }
        document.getElementById('general-budget-table').innerHTML = budgetHTML + `</tbody>`;

        let opexDetailsHTML = `<thead><tr><th>Month</th><th>FTE</th><th>Payroll</th><th>Benefits & Taxes</th><th>Recruiting Fees</th><th>Sales Bonuses</th><th>Travel</th><th>IT & Comms</th><th>Total OpEx</th></tr></thead><tbody>`;
        data.monthlyData.forEach(m => {
            const year = Math.ceil(m.month / 12);
            opexDetailsHTML += `<tr class="monthly-opex-row" data-year="${year}"><td>M${(m.month - 1) % 12 + 1}</td><td>${m.activeFTE}</td><td>${formatCurrency(m.payroll)}</td><td>${formatCurrency(m.benefitsTaxes)}</td><td class="${m.recruitingFees > 0 ? 'loss' : ''}">${formatCurrency(m.recruitingFees)}</td><td class="${m.salesBonuses > 0 ? 'loss' : ''}">${formatCurrency(m.salesBonuses)}</td><td>${formatCurrency(m.travel)}</td><td>${formatCurrency(m.it + m.comms)}</td><td><strong>${formatCurrency(m.totalOpEx)}</strong></td></tr>`;
        });
        document.getElementById('opex-details-table').innerHTML = opexDetailsHTML + `</tbody>`;

        const yearlyOpEx = { payroll:[], benefits:[], fees:[], bonuses:[], travel:[], itComms:[] };
        for (let y=0; y<5; y++) {
            const yearData = data.monthlyData.slice(y*12, (y+1)*12);
            yearlyOpEx.payroll.push(yearData.reduce((s, m) => s + m.payroll, 0));
            yearlyOpEx.benefits.push(yearData.reduce((s, m) => s + m.benefitsTaxes, 0));
            yearlyOpEx.fees.push(yearData.reduce((s, m) => s + m.recruitingFees, 0));
            yearlyOpEx.bonuses.push(yearData.reduce((s, m) => s + m.salesBonuses, 0));
            yearlyOpEx.travel.push(yearData.reduce((s, m) => s + m.travel, 0));
            yearlyOpEx.itComms.push(yearData.reduce((s, m) => s + m.it + m.comms, 0));
        }
        renderChart('opexChart', 'opexChart', {
            type: 'bar',
            data: {
                labels: Array.from({length: 5}, (_, i) => `Y${i+1}`),
                datasets: [
                    { label: 'Payroll', data: yearlyOpEx.payroll, backgroundColor: '#0d47a1' },
                    { label: 'Benefits & Taxes', data: yearlyOpEx.benefits, backgroundColor: '#1976d2' },
                    { label: 'Recruiting Fees', data: yearlyOpEx.fees, backgroundColor: '#2196f3' },
                    { label: 'Sales Bonuses', data: yearlyOpEx.bonuses, backgroundColor: '#64b5f6' },
                    { label: 'Travel', data: yearlyOpEx.travel, backgroundColor: '#90caf9' },
                    { label: 'IT & Comms', data: yearlyOpEx.itComms, backgroundColor: '#bbdefb' },
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, ticks: { callback: v => formatCurrency(v, true) } } }, plugins: { title: { display: true, text: 'Yearly Operating Expenses by Category', color: '#e6edf3', font: {size: 18}}, legend: { position: 'bottom', labels: {color: '#e6edf3'}}} }
        });
        
        let yearButtonsHTML = "";
        for (let y = 1; y <= 5; y++) {
            yearButtonsHTML += `<button data-action="show-opex-year" data-value="${y}" class="year-btn ${y === 1 ? 'active' : ''}">Year ${y}</button>`;
        }
        document.getElementById('opex-year-buttons').innerHTML = yearButtonsHTML;

        showOpExYear(1);
    }

    function showOpExYear(year, button) {
        if (button) {
            document.querySelectorAll('#opex-year-buttons .year-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }
        document.querySelectorAll('.monthly-opex-row').forEach(row => {
            row.style.display = row.dataset.year == year ? 'table-row' : 'none';
        });
    }

    function initializePeopleAndBudgetView() {
        renderPeopleAndBudgetView();
        const container = document.querySelector('.employee-costs-container');
        if (container) {
            container.addEventListener('click', (event) => {
                const button = event.target.closest('button[data-action="show-opex-year"]');
                if (button) {
                    showOpExYear(parseInt(button.dataset.value), button);
                }
            });
        }
    }


    // --- Marketplace Dashboard ---

    function initializeMarketplaceDashboard() {
        const container = document.querySelector('.gtm-container');
        if (!container) return;

        container.addEventListener('click', (event) => {
            const button = event.target.closest('button[data-action]');
            if (!button) return;

            const { action, value } = button.dataset;
            switch (action) {
                case 'update-gtm-market':
                    document.querySelectorAll('#gtm-market-selector .control-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    GTM_PARAMS = value === 'crypto' ? JSON.parse(JSON.stringify(GTM_DEFAULTS_CRYPTO)) : JSON.parse(JSON.stringify(GTM_DEFAULTS_FOREX));
                    syncUIToGTMState();
                    updateMarketplaceView();
                    break;
                case 'rerun-gtm-model':
                    updateMarketplaceView();
                    break;
                case 'show-gtm-year':
                    showGTMYear(parseInt(value), button);
                    break;
            }
        });

        document.getElementById('growth-model-toggle').addEventListener('change', (event) => {
            const isLinear = event.target.checked;
            document.getElementById('s-curve-controls').style.display = isLinear ? 'none' : 'block';
            document.getElementById('linear-model-controls').style.display = isLinear ? 'block' : 'none';
            updateMarketplaceView();
        });

        const aumSlider = document.getElementById('aum-slider');
        const returnSlider = document.getElementById('return-slider');
        aumSlider.addEventListener('input', () => document.getElementById('aum-value').textContent = formatCurrency(parseFloat(aumSlider.value)));
        aumSlider.addEventListener('change', updateMarketplaceView);
        returnSlider.addEventListener('input', () => document.getElementById('return-value').textContent = `${parseFloat(returnSlider.value).toFixed(1)}%`);
        returnSlider.addEventListener('change', updateMarketplaceView);

        syncUIToGTMState();
        updateMarketplaceView();
    }

    function syncUIToGTMState() {
        document.querySelectorAll('#gtm-market-selector .control-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.value === GTM_PARAMS.market));
        document.getElementById('aum-slider').value = GTM_PARAMS.aumPerUser;
        document.getElementById('aum-value').textContent = formatCurrency(GTM_PARAMS.aumPerUser);
        document.getElementById('return-slider').value = GTM_PARAMS.monthlyReturn * 100;
        document.getElementById('return-value').textContent = `${(GTM_PARAMS.monthlyReturn * 100).toFixed(1)}%`;

        const isLinear = GTM_PARAMS.growthModelType === 'linear';
        document.getElementById('growth-model-toggle').checked = isLinear;
        document.getElementById('s-curve-controls').style.display = isLinear ? 'none' : 'block';
        document.getElementById('linear-model-controls').style.display = isLinear ? 'block' : 'none';
        document.getElementById('linear-copiers-input').value = GTM_PARAMS.linearNewCopiersPerPartner;

        for (let i = 1; i <= 5; i++) {
            document.getElementById(`g-y${i}`).value = (GTM_PARAMS.customParams.growthModel[i].growth * 100).toFixed(1);
            document.getElementById(`c-y${i}`).value = (GTM_PARAMS.customParams.growthModel[i].churn * 100).toFixed(1);
        }
    }

    function syncAndGetMarketplaceInputs() {
        GTM_PARAMS.market = document.querySelector('#gtm-market-selector .control-btn.active').dataset.value;
        GTM_PARAMS.growthModelType = document.getElementById('growth-model-toggle').checked ? 'linear' : 's-curve';
        GTM_PARAMS.aumPerUser = parseFloat(document.getElementById('aum-slider').value) || 0;
        GTM_PARAMS.monthlyReturn = (parseFloat(document.getElementById('return-slider').value) || 0) / 100;
        GTM_PARAMS.linearNewCopiersPerPartner = parseFloat(document.getElementById('linear-copiers-input').value) || 0;
        for (let i = 1; i <= 5; i++) {
            GTM_PARAMS.customParams.growthModel[i] = {
                growth: (parseFloat(document.getElementById(`g-y${i}`).value) || 0) / 100,
                churn: (parseFloat(document.getElementById(`c-y${i}`).value) || 0) / 100
            };
        }
        return GTM_PARAMS;
    }

    function updateMarketplaceView() {
        const inputs = syncAndGetMarketplaceInputs();
        const data = calculateGTMModel(inputs);
        const marketName = inputs.market.charAt(0).toUpperCase() + inputs.market.slice(1);

        document.getElementById('kpi-title').innerHTML = `Key Performance Indicators <span style="color:var(--accent-blue);">(${marketName})</span>`;
        document.getElementById('strategy-title').innerHTML = `Go-To-Market Strategy <span style="color:var(--accent-blue);">(${marketName})</span>`;

        const { users, profit, revenue } = data.yearly_summary;
        document.getElementById('kpi-copiers').textContent = formatNumber(users.length > 4 ? users[4] : 0);
        document.getElementById('kpi-profit').textContent = formatCurrency(profit.length > 4 ? profit[4] : 0, true);
        document.getElementById('kpi-total-profit').textContent = formatCurrency(profit.reduce((a, b) => a + b, 0), true);

        let cumulativeProfit = 0;
        let breakEvenYear = 'Never';
        for (let i = 0; i < profit.length; i++) {
            if (revenue[i] > 0) {
                cumulativeProfit += profit[i];
                if (cumulativeProfit > 0) {
                    breakEvenYear = `Year ${i + 1}`;
                    break;
                }
            }
        }
        document.getElementById('kpi-breakeven').textContent = breakEvenYear;

        const isCrypto = inputs.market === 'crypto';
        const rolloutStartYear = isCrypto ? 1 : 2;
        let deploymentHTML = '';
        let partnersAdded = 0;
        const partnersPerQuarter = Math.ceil(data.partnerCount / 4);
        for (let q = 1; q <= 4; q++) {
            const newPartners = Math.min(data.partnerCount - partnersAdded, partnersPerQuarter);
            partnersAdded += newPartners;
            deploymentHTML += `<tr><td>Y${rolloutStartYear} Q${q}</td><td>${newPartners}</td><td>${partnersAdded}</td><td>${formatNumber(partnersAdded * 40)}</td></tr>`;
        }
        document.getElementById('deployment-table-body').innerHTML = deploymentHTML;

        let copierGrowthHTML = '';
        for (let y = 1; y <= 5; y++) {
            const yearData = data.monthly.filter(m => Math.ceil(m.month / 12) === y);
            const eoyCopiersPerBot = yearData.length > 0 ? yearData[yearData.length - 1].copiersPerBot : 0;
            copierGrowthHTML += `<tr><td>Year ${y}</td><td>${eoyCopiersPerBot.toFixed(2)}</td></tr>`;
        }
        document.getElementById('copier-growth-table-body').innerHTML = copierGrowthHTML;

        document.getElementById('financial-assumptions-table-body').innerHTML = `<tr><td>Avg. Annual Marketing</td><td>${formatCurrency(150000)}</td></tr><tr><td>Bot Investment / Bot</td><td>${formatCurrency(1000)}</td></tr><tr><td>Total Deployment Cost</td><td>${formatCurrency(40 * data.partnerCount * 1000)}</td></tr><tr><td><em>(Incurred in Year ${rolloutStartYear})</em></td><td></td></tr>`;

        const chartLabels = Array.from({ length: 5 }, (_, i) => `${START_YEAR + i}`);
        const chartColors = { blue: 'rgba(88,166,255,0.7)', green: 'rgba(63,185,80,0.7)', orange: 'rgba(247,120,41,0.7)', text: '#e6edf3', grid: '#30363d' };
        
        renderChart('aum', 'aumChart', { type: 'bar', data: { labels: chartLabels, datasets: [{ data: data.yearly_summary.aum, backgroundColor: chartColors.blue }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, title: { display: true, text: 'Assets Under Management (AUM)', color: chartColors.text, font: { size: 18 } } }, scales: { y: { ticks: { color: chartColors.text, callback: v => formatCurrency(v, true) }, grid: { color: chartColors.grid } }, x: { ticks: { color: chartColors.text }, grid: { color: chartColors.grid } } } } });
        // FIX: Updated chart title and legend
        renderChart('revenue', 'revenueChart', { type: 'bar', data: { labels: chartLabels, datasets: [{ label: 'Gross Revenue', data: data.yearly_summary.revenue, backgroundColor: chartColors.orange }, { label: 'Net Profit/(Loss)', data: data.yearly_summary.profit, backgroundColor: chartColors.green }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: chartColors.text } }, title: { display: true, text: 'Yearly Revenue vs Net Profit/(Loss)', color: chartColors.text, font: { size: 18 } } }, scales: { y: { ticks: { color: chartColors.text, callback: v => formatCurrency(v, true) }, grid: { color: chartColors.grid } }, x: { ticks: { color: chartColors.text }, grid: { color: chartColors.grid } } } } });

        let yearButtonsHTML = "";
        for (let y = 1; y <= 5; y++) {
            yearButtonsHTML += `<button data-action="show-gtm-year" data-value="${y}" class="year-btn ${y === 1 ? 'active' : ''}">Year ${y}</button>`;
        }
        const yearButtonContainer = document.getElementById('marketplace-year-buttons');
        if (yearButtonContainer) {
            yearButtonContainer.innerHTML = yearButtonsHTML;
        }

        let monthlyProjectionsHTML = "";
        data.monthly.forEach(m => {
            const year = Math.ceil(m.month / 12);
            monthlyProjectionsHTML += `<tr class="monthly-gtm-row" data-year="${year}">
                <td>M${(m.month - 1) % 12 + 1}</td>
                <td>${m.activePartners}</td>
                <td>${m.copiersPerBot.toFixed(2)}</td>
                <td>${formatNumber(m.totalCopiers)}</td>
                <td>${formatCurrency(m.aum)}</td>
                <td>${formatCurrency(m.revenue)}</td>
                <td class="${m.netProfit < 0 ? 'loss' : 'profit'}">${formatCurrency(m.netProfit)}</td>
            </tr>`;
        });
        const projectionBody = document.getElementById("monthly-projections-table-body");
        if (projectionBody) {
            projectionBody.innerHTML = monthlyProjectionsHTML;
        }
        showGTMYear(1, document.querySelector('#marketplace-year-buttons .year-btn'));
    }

    function showGTMYear(year, button) {
        if (button) {
            document.querySelectorAll('#marketplace-year-buttons .year-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }
        document.querySelectorAll('.monthly-gtm-row').forEach(row => {
            row.style.display = row.dataset.year == year ? 'table-row' : 'none';
        });
    }

    function initializeIQDashboard(){syncUIToIQState(),updateIQView();const e=document.querySelector('.iq-dashboard-container');e&&e.addEventListener('click',e=>{const t=e.target.closest('button');if(!t)return;const{action:n,value:l}=t.dataset;'show-iq-year'===n?showIQYear(parseInt(l),t):'rerun-iq-model'===n&&updateIQView()})}function syncUIToIQState(){document.getElementById('iq-trials-y1').value=IQ_PARAMS.newFreeTrialsPerMonth[1],document.getElementById('iq-trials-y2').value=IQ_PARAMS.newFreeTrialsPerMonth[2],document.getElementById('iq-trials-y3').value=IQ_PARAMS.newFreeTrialsPerMonth[3],document.getElementById('iq-conv-y1').value=100*IQ_PARAMS.convRate[1],document.getElementById('iq-conv-y2').value=100*IQ_PARAMS.convRate[2],document.getElementById('iq-conv-y3').value=100*IQ_PARAMS.convRate[3],document.getElementById('iq-churn-y1').value=100*IQ_PARAMS.annualPaidChurn[1],document.getElementById('iq-churn-y2').value=100*IQ_PARAMS.annualPaidChurn[2],document.getElementById('iq-churn-y3').value=100*IQ_PARAMS.annualPaidChurn[3],document.getElementById('iq-cost-per-trial').value=IQ_PARAMS.costPerFreeTrial,document.getElementById('iq-annual-uptake').value=100*IQ_PARAMS.planUptake.annual}function syncAndGetIQInputs(){IQ_PARAMS.newFreeTrialsPerMonth={1:parseInt(document.getElementById('iq-trials-y1').value)||0,2:parseInt(document.getElementById('iq-trials-y2').value)||0,3:parseInt(document.getElementById('iq-trials-y3').value)||0},IQ_PARAMS.convRate={1:(parseFloat(document.getElementById('iq-conv-y1').value)||0)/100,2:(parseFloat(document.getElementById('iq-conv-y2').value)||0)/100,3:(parseFloat(document.getElementById('iq-conv-y3').value)||0)/100},IQ_PARAMS.annualPaidChurn={1:(parseFloat(document.getElementById('iq-churn-y1').value)||0)/100,2:(parseFloat(document.getElementById('iq-churn-y2').value)||0)/100,3:(parseFloat(document.getElementById('iq-churn-y3').value)||0)/100},IQ_PARAMS.costPerFreeTrial=parseFloat(document.getElementById('iq-cost-per-trial').value)||0;const e=(parseFloat(document.getElementById('iq-annual-uptake').value)||0)/100;return IQ_PARAMS.planUptake={annual:e,monthly:1-e},IQ_PARAMS}function updateIQView(){const e=syncAndGetIQInputs(),t=calculateIQModel(e);renderIQSummary(t),renderIQMonthly(t)}function renderIQSummary(e){document.getElementById('iq-yearly-summary').innerHTML=`<thead><tr><th>Year</th><th>Total Revenue</th><th>Direct Costs</th><th>Gross Profit</th></tr></thead><tbody>${e.yearly.revenue.map((t,n)=>{const l=e.yearly.grossProfit[n];return`<tr><td><strong>${START_YEAR+n}</strong></td><td class="profit">${formatCurrency(t)}</td><td class="loss">(${formatCurrency(e.yearly.acqCost[n])})</td><td class="${l>0?'profit':'loss'}"><strong>${formatCurrency(l)}</strong></td></tr>`}).join('')}</tbody>`}function renderIQMonthly(e){let t='',n='';for(let l=1;l<=5;l++){const a=e.monthly.filter(e=>Math.ceil(e.month/12)===l),o=1===l?'active':'';n+=`<button data-action="show-iq-year" data-value="${l}" class="year-btn ${o}">Year ${l}</button>`,t+=`<table id="iq-users-${l}" class="data-table monthly-table ${o}"><thead><tr><th>Month</th><th>New Free Trials</th><th>New Paid Users</th><th>Active Free Users</th><th>Total Paid Users</th></tr></thead><tbody>${a.map(e=>`<tr><td>M${(e.month-1)%12+1}</td><td>${formatNumber(e.newFree)}</td><td>${formatNumber(e.newPaid)}</td><td>${formatNumber(e.freeTotal)}</td><td>${formatNumber(e.paidTotal)}</td></tr>`).join('')}</tbody></table>`}document.getElementById('year-buttons').innerHTML=n,document.getElementById('iq-users-tables').innerHTML=t}function showIQYear(e,t){document.querySelectorAll('.iq-dashboard-container .year-btn').forEach(e=>e.classList.remove('active')),t.classList.add('active'),document.querySelectorAll('.iq-dashboard-container .data-table.monthly-table').forEach(e=>e.classList.remove('active')),document.getElementById(`iq-users-${e}`).classList.add('active')}function initializeProDashboard(){syncUIToProState(),updateProView();const e=document.querySelector('.pro-dashboard-container');e&&e.addEventListener('click',e=>{const t=e.target.closest('button');if(!t)return;const{action:n,value:l}=t.dataset;'show-pro-year'===n?showProYear(parseInt(l),t):'rerun-pro-model'===n&&updateProView()})}function syncUIToProState(){document.getElementById('pro-nre-pro').value=PRO_PARAMS.pricing.pro.nre,document.getElementById('pro-license-pro').value=PRO_PARAMS.pricing.pro.license,document.getElementById('pro-nre-ent').value=PRO_PARAMS.pricing.enterprise.nre,document.getElementById('pro-license-ent').value=PRO_PARAMS.pricing.enterprise.license;for(let e=0;e<5;e++)document.getElementById(`pro-deals-pro-y${e+1}`).value=PRO_PARAMS.newDealsPerYear.pro[e],document.getElementById(`pro-deals-ent-y${e+1}`).value=PRO_PARAMS.newDealsPerYear.enterprise[e];document.getElementById('pro-aff-adoption').value=100*PRO_PARAMS.affiliateParams.adoptionRate,document.getElementById('pro-aff-copiers').value=PRO_PARAMS.affiliateParams.avgCopiersPerAffiliate,document.getElementById('pro-aff-aum').value=PRO_PARAMS.affiliateParams.avgAumPerCopier,document.getElementById('pro-aff-share').value=100*PRO_PARAMS.affiliateParams.quantixProfitShare,document.getElementById('pro-server-pro').value=PRO_PARAMS.serverCosts.pro,document.getElementById('pro-server-ent').value=PRO_PARAMS.serverCosts.enterprise}function syncAndGetProInputs(){PRO_PARAMS.pricing.pro.nre=parseFloat(document.getElementById('pro-nre-pro').value)||0,PRO_PARAMS.pricing.pro.license=parseFloat(document.getElementById('pro-license-pro').value)||0,PRO_PARAMS.pricing.enterprise.nre=parseFloat(document.getElementById('pro-nre-ent').value)||0,PRO_PARAMS.pricing.enterprise.license=parseFloat(document.getElementById('pro-license-ent').value)||0;for(let e=0;e<5;e++)PRO_PARAMS.newDealsPerYear.pro[e]=parseInt(document.getElementById(`pro-deals-pro-y${e+1}`).value)||0,PRO_PARAMS.newDealsPerYear.enterprise[e]=parseInt(document.getElementById(`pro-deals-ent-y${e+1}`).value)||0;return PRO_PARAMS.affiliateParams.adoptionRate=(parseFloat(document.getElementById('pro-aff-adoption').value)||0)/100,PRO_PARAMS.affiliateParams.avgCopiersPerAffiliate=parseInt(document.getElementById('pro-aff-copiers').value)||0,PRO_PARAMS.affiliateParams.avgAumPerCopier=parseFloat(document.getElementById('pro-aff-aum').value)||0,PRO_PARAMS.affiliateParams.quantixProfitShare=(parseFloat(document.getElementById('pro-aff-share').value)||0)/100,PRO_PARAMS.serverCosts.pro=parseFloat(document.getElementById('pro-server-pro').value)||0,PRO_PARAMS.serverCosts.enterprise=parseFloat(document.getElementById('pro-server-ent').value)||0,PRO_PARAMS}function updateProView(){const e=syncAndGetProInputs(),t=calculateProModel(e);renderProSummary(t),renderProMonthly(t)}function renderProSummary(e){document.getElementById('pro-yearly-summary').innerHTML=`<thead><tr><th>Year</th><th>Total Revenue</th><th>Direct Costs</th><th>Gross Profit</th><th>Total Contracts</th></tr></thead><tbody>${e.yearly.revenue.map((t,n)=>{const l=e.yearly.grossProfit[n],r=e.yearly.costs[n];return`<tr><td><strong>${START_YEAR+n}</strong></td><td class="profit">${formatCurrency(t)}</td><td class="loss">(${formatCurrency(r)})</td><td class="${l>0?'profit':'loss'}"><strong>${formatCurrency(l)}</strong></td><td>${formatNumber(e.yearly.totalPro[n]+e.yearly.totalEnterprise[n])}</td></tr>`}).join('')}</tbody>`}function renderProMonthly(e){let t='',n='';for(let l=1;l<=5;l++){const r=e.monthly.filter(e=>Math.ceil(e.m/12)===l),o=1===l?'active':'';n+=`<button data-action="show-pro-year" data-value="${l}" class="year-btn ${o}">Year ${l}</button>`,t+=`<table id="pro-monthly-${l}" class="data-table monthly-table ${o}">\n                    <thead><tr><th>Month</th><th>New Pro Deals</th><th>New Ent. Deals</th><th>License Revenue</th><th>Affiliate Revenue</th><th>Server Costs</th></tr></thead>\n                    <tbody>${r.map(e=>`<tr><td>M${(e.m-1)%12+1}</td><td>${formatNumber(e.newPro)}</td><td>${formatNumber(e.newEnterprise)}</td><td class="profit">${formatCurrency(e.licenseRevenue)}</td><td class="profit">${formatCurrency(e.affiliateRevenue)}</td><td class="loss">(${formatCurrency(e.serverCost)})</td></tr>`).join('')}</tbody>\n                </table>`}document.getElementById('pro-year-buttons').innerHTML=n,document.getElementById('pro-monthly-tables').innerHTML=t}function showProYear(e,t){document.querySelectorAll('.pro-dashboard-container .year-btn').forEach(e=>e.classList.remove('active')),t.classList.add('active'),document.querySelectorAll('.pro-dashboard-container .data-table.monthly-table').forEach(e=>e.classList.remove('active')),document.getElementById(`pro-monthly-${e}`).classList.add('active')}

    // --- MAIN APPLICATION CONTROLLER ---
    function setMarket(market) {
        document.querySelectorAll('#main-nav-selector .control-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`#main-nav-selector [data-value="${market}"]`).classList.add('active');
        
        const dashboardContent = document.getElementById('dashboard-content');
        const template = document.getElementById('template-' + market);
        if (!template) { dashboardContent.innerHTML = `<p>Error: Template for '${market}' not found.</p>`; return; }
        
        dashboardContent.innerHTML = '';
        dashboardContent.appendChild(template.content.cloneNode(true));
        
        switch(market) {
            case 'summary': renderSummaryView(); break;
            case 'marketplace': initializeMarketplaceDashboard(); break;
            case 'iq': initializeIQDashboard(); break;
            case 'pro': initializeProDashboard(); break;
            case 'people_and_budget': initializePeopleAndBudgetView(); break;
        }
    }
    
    // --- INITIALIZATION ---
    function initGlobalState() {
        GTM_DEFAULTS_CRYPTO = { market: 'crypto', aumPerUser: 2000, monthlyReturn: 0.03, growthModelType: 's-curve', linearNewCopiersPerPartner: 330, customParams: { growthModel: { 1: { growth: 0.60, churn: 0.04 }, 2: { growth: 0.25, churn: 0.03 }, 3: { growth: 0.12, churn: 0.02 }, 4: { growth: 0.07, churn: 0.02 }, 5: { growth: 0.07, churn: 0.02 } } } };
        GTM_DEFAULTS_FOREX = { market: 'forex', aumPerUser: 1500, monthlyReturn: 0.03, growthModelType: 's-curve', linearNewCopiersPerPartner: 200, customParams: { growthModel: { 1: { growth: 0.00, churn: 0.00 }, 2: { growth: 0.60, churn: 0.04 }, 3: { growth: 0.25, churn: 0.03 }, 4: { growth: 0.12, churn: 0.02 }, 5: { growth: 0.07, churn: 0.02 } } } };
        IQ_DEFAULTS = { startMonth: 6, costPerFreeTrial: 15, planUptake: { annual: 0.7, monthly: 0.3 }, paidUserDist: { basic: 0.6, pro: 0.3, elite: 0.1 }, newFreeTrialsPerMonth: { 1: 700, 2: 2500, 3: 4500 }, convRate: { 1: 0.10, 2: 0.15, 3: 0.20 }, annualPaidChurn: { 1: 0.35, 2: 0.25, 3: 0.15 } };
        PRO_DEFAULTS = { annualChurnRate: 0.05, pricing: { pro: {nre: 0, license: 10000 }, enterprise: { nre: 250000, license: 120000 } }, newDealsPerYear: { pro: [2, 4, 8, 10, 12], enterprise: [1, 2, 3, 4, 5] }, affiliateParams: { adoptionRate: 0.40, avgCopiersPerAffiliate: 150, avgAumPerCopier: 1500, monthlyBotReturn: 0.03, quantixProfitShare: 0.30 }, serverCosts: { pro: 202.40, enterprise: 202.40 } };
        PEOPLE_DEFAULTS = { 
            benefitsAndTaxRate: 0.25, guaranteedSalesBonus: 2500, itPerFTE: 250, commsPerFTE: 2000,
            travelBudget: { cLevel: 10000, director: 3000, standard: 1500 },
            recruitingFeeTiers: { cLevel: 0.35, director: 0.30, standard: 0.25 },
            employees: [
                { role: 'CEO', baseSalary: 360000, doh: 1, type: 'cLevel', adjustments:[-0.65,-0.50,-0.40,0.00,0.00] },
                { role: 'CFO', baseSalary: 250000, doh: 1, type: 'cLevel', adjustments:[-0.95,-0.90,-0.75,-0.25,0.00] },
                { role: 'COO', baseSalary: 225000, doh: 1, type: 'cLevel', adjustments:[-0.72,-0.60,-0.50,-0.25,0.00] },
                { role: 'C Inv. O', baseSalary: 225000, doh: 13, type: 'cLevel', adjustments:[-1.00,-1.00,-0.50,-0.25,0.00] },
                { role: 'CTO', baseSalary: 250000, doh: 1, type: 'cLevel', adjustments:[-0.45,-0.35,0.00,0.00,1.00] },
                { role: 'C Comp. O', baseSalary: 225000, doh: 1, type: 'cLevel', adjustments:[-0.75,-0.60,0.00,0.00,1.00] },
                { role: 'VP of Engineering', baseSalary: 175000, doh: 1, type: 'director', adjustments:[-0.75,-0.65,-0.50,0.00,1.00] },
                { role: 'Director of Engineering', baseSalary: 145000, doh: 1, type: 'director', adjustments:[-0.75,-0.65,-0.50,0.00,1.00] },
                { role: 'VP Customer Success', baseSalary: 225000, doh: 25, type: 'director', adjustments:[-1.00,-1.00,-0.50,-0.30,0.00] },
                { role: 'VP of Sales', baseSalary: 175000, doh: 1, type: 'director', adjustments:[-0.65,-0.60,-0.43,-0.40,-0.55], recruitingInstallments: true },
                { role: 'Full Stack Engineer', baseSalary: 80000, doh: 1, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 1, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 1, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 13, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 13, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 25, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 25, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 25, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 37, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 37, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 37, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 37, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 49, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 49, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] }, { role: 'Full Stack Engineer', baseSalary: 80000, doh: 49, type: 'standard', adjustments:[-0.75,-0.65,-0.60,0.00,1.00] },
                { role: 'R&D', baseSalary: 150000, doh: 1, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] }, { role: 'R&D', baseSalary: 150000, doh: 13, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] }, { role: 'R&D', baseSalary: 150000, doh: 13, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] }, { role: 'R&D', baseSalary: 150000, doh: 25, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] }, { role: 'R&D', baseSalary: 150000, doh: 37, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] }, { role: 'R&D', baseSalary: 150000, doh: 37, type: 'standard', adjustments:[-0.65,-0.55,0.00,0.00,0.20] },
                { role: 'Analyst', baseSalary: 40000, doh: 1, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 13, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 25, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 25, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 37, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 37, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 49, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] }, { role: 'Analyst', baseSalary: 40000, doh: 49, type: 'standard', adjustments:[-0.80,-0.75,0.00,0.00,1.00] },
                { role: 'Software Test Engineer', baseSalary: 35000, doh: 1, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] }, { role: 'Software Test Engineer', baseSalary: 35000, doh: 13, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] }, { role: 'Software Test Engineer', baseSalary: 35000, doh: 25, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] }, { role: 'Software Test Engineer', baseSalary: 35000, doh: 25, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] }, { role: 'Software Test Engineer', baseSalary: 35000, doh: 37, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] }, { role: 'Software Test Engineer', baseSalary: 35000, doh: 37, type: 'standard', adjustments:[-0.75,-0.75,0.00,0.00,1.00] },
                { role: 'Support', baseSalary: 25000, doh: 1, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 1, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 13, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 25, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 25, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 37, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 37, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 49, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 49, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] }, { role: 'Support', baseSalary: 25000, doh: 49, type: 'standard', adjustments:[-0.45,-0.45,0.00,0.00,1.00] },
                { role: 'Sales', baseSalary: 135000, doh: 13, type: 'sales', adjustments:[-1.00,-0.60,0.00,0.00,0.00] }, { role: 'Sales', baseSalary: 135000, doh: 13, type: 'sales', adjustments:[-1.00,-0.60,0.00,0.00,0.00] }, { role: 'Sales', baseSalary: 135000, doh: 13, type: 'sales', adjustments:[-1.00,-0.60,0.00,0.00,0.00] }, { role: 'Sales', baseSalary: 135000, doh: 49, type: 'sales', adjustments:[-1.00,-0.60,0.00,0.00,0.00] }, { role: 'Sales', baseSalary: 135000, doh: 49, type: 'sales', adjustments:[-1.00,-0.60,0.00,0.00,0.00] },
                { role: 'Marketing', baseSalary: 80000, doh: 13, type: 'standard', adjustments:[-1.00,-0.50,0.00,0.00,0.00] }, { role: 'Marketing', baseSalary: 80000, doh: 37, type: 'standard', adjustments:[-1.00,-0.50,0.00,0.00,0.00] },
            ],
            hiringPlan: {'CEO':[1,1,1,1,1],'CFO':[1,1,1,1,1],'COO':[1,1,1,1,1],'C Inv. O':[0,1,1,1,1],'CTO':[1,1,1,1,1],'C Comp. O':[1,1,1,1,1],'VP of Engineering':[1,1,1,1,1],'Director of Engineering':[1,1,1,1,1],'Full Stack Engineer(s)':[3,5,8,12,15],'R & D':[1,3,4,6,6],'Analyst':[1,2,4,6,8],'Software Test Engineer':[1,2,4,6,6],'VP Customer Success':[0,0,1,1,1],'Support':[2,3,5,7,10],'VP of Sales':[1,1,1,1,1],'Sales':[0,3,3,3,5],'Marketing':[0,1,1,2,2]},
            salaryAdjustments: {'CEO':[-0.65,-0.50,-0.40,0.00,0.00],'CFO':[-0.95,-0.90,-0.75,-0.25,0.00],'COO':[-0.72,-0.60,-0.50,-0.25,0.00],'C Inv. O':[-1.00,-1.00,-0.50,-0.25,0.00],'CTO':[-0.45,-0.35,0.00,0.00,1.00],'C Comp. O':[-0.75,-0.60,0.00,0.00,1.00],'VP of Engineering':[-0.75,-0.65,-0.50,0.00,1.00],'Director of Engineering':[-0.75,-0.65,-0.50,0.00,1.00],'Full Stack Engineer(s)':[-0.75,-0.65,-0.60,0.00,1.00],'R & D':[-0.65,-0.55,0.00,0.00,0.20],'Analyst':[-0.80,-0.75,0.00,0.00,1.00],'Software Test Engineer':[-0.75,-0.75,0.00,0.00,1.00],'VP Customer Success':[-1.00,-1.00,-0.50,-0.30,0.00],'Support':[-0.45,-0.45,0.00,0.00,1.00],'VP of Sales':[-0.65,-0.60,-0.43,-0.40,-0.55],'Sales':[-1.00,-0.60,0.00,0.00,0.00],'Marketing':[-0.50,-0.50,0.00,0.00,0.00]},
            generalBudget: {'Travel':4000,'IT':250,'Comms Cost':2000},
        };
        
        GTM_PARAMS = JSON.parse(JSON.stringify(GTM_DEFAULTS_CRYPTO));
        IQ_PARAMS = JSON.parse(JSON.stringify(IQ_DEFAULTS));
        PRO_PARAMS = JSON.parse(JSON.stringify(PRO_DEFAULTS));
    }

    // --- ENTRY POINT ---
    document.addEventListener('DOMContentLoaded', () => {
        initGlobalState();
        document.getElementById('main-nav-selector').addEventListener('click', (event) => {
            const button = event.target.closest('button[data-action="set-market"]');
            if (button) setMarket(button.dataset.value);
        });
        document.querySelector('[data-action="reset-all"]').addEventListener('click', () => {
            initGlobalState();
            const currentMarket = document.querySelector('#main-nav-selector .control-btn.active').dataset.value;
            setMarket(currentMarket);
        });
        setMarket('summary');
    });

    </script>
</body>
</html>
